!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.lumo=t()}}(function(){return function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){"use strict";function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"number"==typeof t}function a(t){return"object"===("undefined"==typeof t?"undefined":u(t))&&null!==t}function s(t){return void 0===t}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,o,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(n=this._events[t],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(a(n))for(o=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,u=0;u<r;u++)l[u].apply(this,o);return!0},r.prototype.addListener=function(t,e){var n;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?a(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,a(this._events[t])&&!this._events[t].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,o,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],o=n.length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(a(n)){for(s=o;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){"use strict";var r=t("./_root"),i=r.Symbol;e.exports=i},{"./_root":21}],3:[function(t,e,n){"use strict";function r(t,e){var n=a(t),r=!n&&o(t),c=!n&&!r&&s(t),h=!n&&!r&&!c&&l(t),p=n||r||c||h,d=p?i(t.length,String):[],v=d.length;for(var y in t)!e&&!f.call(t,y)||p&&("length"==y||c&&("offset"==y||"parent"==y)||h&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||u(y,v))||d.push(y);return d}var i=t("./_baseTimes"),o=t("./isArguments"),a=t("./isArray"),s=t("./isBuffer"),u=t("./_isIndex"),l=t("./isTypedArray"),c=Object.prototype,f=c.hasOwnProperty;e.exports=r},{"./_baseTimes":10,"./_isIndex":16,"./isArguments":27,"./isArray":28,"./isBuffer":30,"./isTypedArray":36}],4:[function(t,e,n){"use strict";function r(t,e,n){return t===t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}e.exports=r},{}],5:[function(t,e,n){"use strict";var r=t("./_createBaseFor"),i=r();e.exports=i},{"./_createBaseFor":13}],6:[function(t,e,n){"use strict";function r(t){return null==t?void 0===t?u:s:(t=Object(t),l&&l in t?o(t):a(t))}var i=t("./_Symbol"),o=t("./_getRawTag"),a=t("./_objectToString"),s="[object Null]",u="[object Undefined]",l=i?i.toStringTag:void 0;e.exports=r},{"./_Symbol":2,"./_getRawTag":15,"./_objectToString":20}],7:[function(t,e,n){"use strict";function r(t){return o(t)&&i(t)==a}var i=t("./_baseGetTag"),o=t("./isObjectLike"),a="[object Arguments]";e.exports=r},{"./_baseGetTag":6,"./isObjectLike":34}],8:[function(t,e,n){"use strict";function r(t){return a(t)&&o(t.length)&&!!j[i(t)]}var i=t("./_baseGetTag"),o=t("./isLength"),a=t("./isObjectLike"),s="[object Arguments]",u="[object Array]",l="[object Boolean]",c="[object Date]",f="[object Error]",h="[object Function]",p="[object Map]",d="[object Number]",v="[object Object]",y="[object RegExp]",m="[object Set]",b="[object String]",g="[object WeakMap]",w="[object ArrayBuffer]",x="[object DataView]",_="[object Float32Array]",E="[object Float64Array]",T="[object Int8Array]",O="[object Int16Array]",P="[object Int32Array]",A="[object Uint8Array]",R="[object Uint8ClampedArray]",S="[object Uint16Array]",L="[object Uint32Array]",j={};j[_]=j[E]=j[T]=j[O]=j[P]=j[A]=j[R]=j[S]=j[L]=!0,j[s]=j[u]=j[w]=j[l]=j[x]=j[c]=j[f]=j[h]=j[p]=j[d]=j[v]=j[y]=j[m]=j[b]=j[g]=!1,e.exports=r},{"./_baseGetTag":6,"./isLength":32,"./isObjectLike":34}],9:[function(t,e,n){"use strict";function r(t){if(!i(t))return a(t);var e=o(t),n=[];for(var r in t)("constructor"!=r||!e&&u.call(t,r))&&n.push(r);return n}var i=t("./isObject"),o=t("./_isPrototype"),a=t("./_nativeKeysIn"),s=Object.prototype,u=s.hasOwnProperty;e.exports=r},{"./_isPrototype":17,"./_nativeKeysIn":18,"./isObject":33}],10:[function(t,e,n){"use strict";function r(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}e.exports=r},{}],11:[function(t,e,n){"use strict";function r(t){return function(e){return t(e)}}e.exports=r},{}],12:[function(t,e,n){"use strict";function r(t){return"function"==typeof t?t:i}var i=t("./identity");e.exports=r},{"./identity":26}],13:[function(t,e,n){"use strict";function r(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(n(o[u],u,o)===!1)break}return e}}e.exports=r},{}],14:[function(t,e,n){(function(t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r="object"==("undefined"==typeof t?"undefined":n(t))&&t&&t.Object===Object&&t;e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(t,e,n){"use strict";function r(t){var e=a.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var i=s.call(t);return r&&(e?t[u]=n:delete t[u]),i}var i=t("./_Symbol"),o=Object.prototype,a=o.hasOwnProperty,s=o.toString,u=i?i.toStringTag:void 0;e.exports=r},{"./_Symbol":2}],16:[function(t,e,n){"use strict";function r(t,e){return e=null==e?i:e,!!e&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&t<e}var i=9007199254740991,o=/^(?:0|[1-9]\d*)$/;e.exports=r},{}],17:[function(t,e,n){"use strict";function r(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||i;return t===n}var i=Object.prototype;e.exports=r},{}],18:[function(t,e,n){"use strict";function r(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}e.exports=r},{}],19:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./_freeGlobal"),o="object"==("undefined"==typeof n?"undefined":r(n))&&n&&!n.nodeType&&n,a=o&&"object"==("undefined"==typeof e?"undefined":r(e))&&e&&!e.nodeType&&e,s=a&&a.exports===o,u=s&&i.process,l=function(){try{return u&&u.binding&&u.binding("util")}catch(t){}}();e.exports=l},{"./_freeGlobal":14}],20:[function(t,e,n){"use strict";function r(t){return o.call(t)}var i=Object.prototype,o=i.toString;e.exports=r},{}],21:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./_freeGlobal"),o="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,a=i||o||Function("return this")();e.exports=a},{"./_freeGlobal":14}],22:[function(t,e,n){"use strict";function r(t,e,n){return void 0===n&&(n=e,e=void 0),void 0!==n&&(n=o(n),n=n===n?n:0),void 0!==e&&(e=o(e),e=e===e?e:0),i(o(t),e,n)}var i=t("./_baseClamp"),o=t("./toNumber");e.exports=r},{"./_baseClamp":4,"./toNumber":41}],23:[function(t,e,n){"use strict";function r(t,e,n){function r(e){var n=b,r=g;return b=g=void 0,T=e,x=t.apply(r,n)}function c(t){return T=t,_=setTimeout(p,e),O?r(t):x}function f(t){var n=t-E,r=t-T,i=e-n;return P?l(i,w-r):i}function h(t){var n=t-E,r=t-T;return void 0===E||n>=e||n<0||P&&r>=w}function p(){var t=o();return h(t)?d(t):void(_=setTimeout(p,f(t)))}function d(t){return _=void 0,A&&b?r(t):(b=g=void 0,x)}function v(){void 0!==_&&clearTimeout(_),T=0,b=E=g=_=void 0}function y(){return void 0===_?x:d(o())}function m(){var t=o(),n=h(t);if(b=arguments,g=this,E=t,n){if(void 0===_)return c(E);if(P)return _=setTimeout(p,e),r(E)}return void 0===_&&(_=setTimeout(p,e)),x}var b,g,w,x,_,E,T=0,O=!1,P=!1,A=!0;if("function"!=typeof t)throw new TypeError(s);return e=a(e)||0,i(n)&&(O=!!n.leading,P="maxWait"in n,w=P?u(a(n.maxWait)||0,e):w,A="trailing"in n?!!n.trailing:A),m.cancel=v,m.flush=y,m}var i=t("./isObject"),o=t("./now"),a=t("./toNumber"),s="Expected a function",u=Math.max,l=Math.min;e.exports=r},{"./isObject":33,"./now":38,"./toNumber":41}],24:[function(t,e,n){"use strict";function r(t,e){return null==t||t!==t?e:t}e.exports=r},{}],25:[function(t,e,n){"use strict";function r(t,e){return null==t?t:i(t,o(e),a)}var i=t("./_baseFor"),o=t("./_castFunction"),a=t("./keysIn");e.exports=r},{"./_baseFor":5,"./_castFunction":12,"./keysIn":37}],26:[function(t,e,n){"use strict";function r(t){return t}e.exports=r},{}],27:[function(t,e,n){"use strict";var r=t("./_baseIsArguments"),i=t("./isObjectLike"),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(t){return i(t)&&a.call(t,"callee")&&!s.call(t,"callee")};e.exports=u},{"./_baseIsArguments":7,"./isObjectLike":34}],28:[function(t,e,n){"use strict";var r=Array.isArray;e.exports=r},{}],29:[function(t,e,n){"use strict";function r(t){return null!=t&&o(t.length)&&!i(t)}var i=t("./isFunction"),o=t("./isLength");e.exports=r},{"./isFunction":31,"./isLength":32}],30:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./_root"),o=t("./stubFalse"),a="object"==("undefined"==typeof n?"undefined":r(n))&&n&&!n.nodeType&&n,s=a&&"object"==("undefined"==typeof e?"undefined":r(e))&&e&&!e.nodeType&&e,u=s&&s.exports===a,l=u?i.Buffer:void 0,c=l?l.isBuffer:void 0,f=c||o;e.exports=f},{"./_root":21,"./stubFalse":39}],31:[function(t,e,n){"use strict";function r(t){if(!o(t))return!1;var e=i(t);return e==s||e==u||e==a||e==l}var i=t("./_baseGetTag"),o=t("./isObject"),a="[object AsyncFunction]",s="[object Function]",u="[object GeneratorFunction]",l="[object Proxy]";e.exports=r},{"./_baseGetTag":6,"./isObject":33}],32:[function(t,e,n){"use strict";function r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}var i=9007199254740991;e.exports=r},{}],33:[function(t,e,n){"use strict";function r(t){var e="undefined"==typeof t?"undefined":i(t);return null!=t&&("object"==e||"function"==e)}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.exports=r},{}],34:[function(t,e,n){"use strict";function r(t){return null!=t&&"object"==("undefined"==typeof t?"undefined":i(t))}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.exports=r},{}],35:[function(t,e,n){"use strict";function r(t){return"symbol"==("undefined"==typeof t?"undefined":i(t))||a(t)&&o(t)==s}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=t("./_baseGetTag"),a=t("./isObjectLike"),s="[object Symbol]";e.exports=r},{"./_baseGetTag":6,"./isObjectLike":34}],36:[function(t,e,n){"use strict";var r=t("./_baseIsTypedArray"),i=t("./_baseUnary"),o=t("./_nodeUtil"),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},{"./_baseIsTypedArray":8,"./_baseUnary":11,"./_nodeUtil":19}],37:[function(t,e,n){"use strict";function r(t){return a(t)?i(t,!0):o(t)}var i=t("./_arrayLikeKeys"),o=t("./_baseKeysIn"),a=t("./isArrayLike");e.exports=r},{"./_arrayLikeKeys":3,"./_baseKeysIn":9,"./isArrayLike":29}],38:[function(t,e,n){"use strict";var r=t("./_root"),i=function(){return r.Date.now()};e.exports=i},{"./_root":21}],39:[function(t,e,n){"use strict";function r(){return!1}e.exports=r},{}],40:[function(t,e,n){"use strict";function r(t,e,n){var r=!0,s=!0;if("function"!=typeof t)throw new TypeError(a);return o(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),i(t,e,{leading:r,maxWait:e,trailing:s})}var i=t("./debounce"),o=t("./isObject"),a="Expected a function";e.exports=r},{"./debounce":23,"./isObject":33}],41:[function(t,e,n){"use strict";function r(t){if("number"==typeof t)return t;if(o(t))return a;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(s,"");var n=l.test(t);return n||c.test(t)?f(t.slice(2),n?2:8):u.test(t)?a:+t}var i=t("./isObject"),o=t("./isSymbol"),a=NaN,s=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,f=parseInt;e.exports=r},{"./isObject":33,"./isSymbol":35}],42:[function(t,e,n){"use strict";function r(t,e,n){var r;return y[e]?r=y[e]:(r=h(e),y[e]=r),2===arguments.length?t[r]:(t[r]=n,n)}function i(){return 1}function o(t){if(!(this instanceof o))return new o(t);"number"==typeof t&&(t={max:t}),t||(t={});var e=r(this,"max",t.max);(!e||"number"!=typeof e||e<=0)&&r(this,"max",1/0);var n=t.length||i;"function"!=typeof n&&(n=i),r(this,"lengthCalculator",n),r(this,"allowStale",t.stale||!1),r(this,"maxAge",t.maxAge||0),r(this,"dispose",t.dispose),this.reset()}function a(t,e,n,i){var o=n.value;u(t,o)&&(c(t,n),r(t,"allowStale")||(o=void 0)),o&&e.call(i,o.value,o.key,t)}function s(t,e,n){var i=r(t,"cache").get(e);if(i){var o=i.value;u(t,o)?(c(t,i),r(t,"allowStale")||(o=void 0)):n&&r(t,"lruList").unshiftNode(i),o&&(o=o.value)}return o}function u(t,e){if(!e||!e.maxAge&&!r(t,"maxAge"))return!1;var n=!1,i=Date.now()-e.now;return n=e.maxAge?i>e.maxAge:r(t,"maxAge")&&i>r(t,"maxAge")}function l(t){if(r(t,"length")>r(t,"max"))for(var e=r(t,"lruList").tail;r(t,"length")>r(t,"max")&&null!==e;){var n=e.prev;c(t,e),e=n}}function c(t,e){if(e){var n=e.value;r(t,"dispose")&&r(t,"dispose").call(this,n.key,n.value),r(t,"length",r(t,"length")-n.length),r(t,"cache").delete(n.key),r(t,"lruList").removeNode(e)}}function f(t,e,n,r,i){this.key=t,this.value=e,this.length=n,this.now=r,this.maxAge=i||0}e.exports=o;var h,p=t("pseudomap"),d=t("util"),v=t("yallist"),y={},m="function"==typeof Symbol;h=m?function(t){return Symbol.for(t)}:function(t){return"_"+t},Object.defineProperty(o.prototype,"max",{set:function(t){(!t||"number"!=typeof t||t<=0)&&(t=1/0),r(this,"max",t),l(this)},get:function(){return r(this,"max")},enumerable:!0}),Object.defineProperty(o.prototype,"allowStale",{set:function(t){r(this,"allowStale",!!t)},get:function(){return r(this,"allowStale")},enumerable:!0}),Object.defineProperty(o.prototype,"maxAge",{set:function(t){(!t||"number"!=typeof t||t<0)&&(t=0),r(this,"maxAge",t),l(this)},get:function(){return r(this,"maxAge")},enumerable:!0}),Object.defineProperty(o.prototype,"lengthCalculator",{set:function(t){"function"!=typeof t&&(t=i),t!==r(this,"lengthCalculator")&&(r(this,"lengthCalculator",t),r(this,"length",0),r(this,"lruList").forEach(function(t){t.length=r(this,"lengthCalculator").call(this,t.value,t.key),r(this,"length",r(this,"length")+t.length)},this)),l(this)},get:function(){return r(this,"lengthCalculator")},enumerable:!0}),Object.defineProperty(o.prototype,"length",{get:function(){return r(this,"length")},enumerable:!0}),Object.defineProperty(o.prototype,"itemCount",{get:function(){return r(this,"lruList").length},enumerable:!0}),o.prototype.rforEach=function(t,e){e=e||this;for(var n=r(this,"lruList").tail;null!==n;){var i=n.prev;a(this,t,n,e),n=i}},o.prototype.forEach=function(t,e){e=e||this;for(var n=r(this,"lruList").head;null!==n;){var i=n.next;a(this,t,n,e),n=i}},o.prototype.keys=function(){return r(this,"lruList").toArray().map(function(t){return t.key},this)},o.prototype.values=function(){return r(this,"lruList").toArray().map(function(t){return t.value},this)},o.prototype.reset=function(){r(this,"dispose")&&r(this,"lruList")&&r(this,"lruList").length&&r(this,"lruList").forEach(function(t){r(this,"dispose").call(this,t.key,t.value)},this),r(this,"cache",new p),r(this,"lruList",new v),r(this,"length",0)},o.prototype.dump=function(){return r(this,"lruList").map(function(t){if(!u(this,t))return{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}},this).toArray().filter(function(t){return t})},o.prototype.dumpLru=function(){return r(this,"lruList")},o.prototype.inspect=function(t,e){var n="LRUCache {",o=!1,a=r(this,"allowStale");a&&(n+="\n  allowStale: true",o=!0);var s=r(this,"max");s&&s!==1/0&&(o&&(n+=","),n+="\n  max: "+d.inspect(s,e),o=!0);var l=r(this,"maxAge");l&&(o&&(n+=","),n+="\n  maxAge: "+d.inspect(l,e),o=!0);var c=r(this,"lengthCalculator");c&&c!==i&&(o&&(n+=","),n+="\n  length: "+d.inspect(r(this,"length"),e),o=!0);var f=!1;return r(this,"lruList").forEach(function(t){f?n+=",\n  ":(o&&(n+=",\n"),f=!0,n+="\n  ");var r=d.inspect(t.key).split("\n").join("\n  "),a={value:t.value};t.maxAge!==l&&(a.maxAge=t.maxAge),c!==i&&(a.length=t.length),u(this,t)&&(a.stale=!0),a=d.inspect(a,e).split("\n").join("\n  "),n+=r+" => "+a}),(f||o)&&(n+="\n"),n+="}"},o.prototype.set=function(t,e,n){n=n||r(this,"maxAge");var i=n?Date.now():0,o=r(this,"lengthCalculator").call(this,e,t);if(r(this,"cache").has(t)){if(o>r(this,"max"))return c(this,r(this,"cache").get(t)),!1;var a=r(this,"cache").get(t),s=a.value;return r(this,"dispose")&&r(this,"dispose").call(this,t,s.value),s.now=i,s.maxAge=n,s.value=e,r(this,"length",r(this,"length")+(o-s.length)),s.length=o,this.get(t),l(this),!0}var u=new f(t,e,o,i,n);return u.length>r(this,"max")?(r(this,"dispose")&&r(this,"dispose").call(this,t,e),!1):(r(this,"length",r(this,"length")+u.length),r(this,"lruList").unshift(u),r(this,"cache").set(t,r(this,"lruList").head),l(this),!0)},o.prototype.has=function(t){if(!r(this,"cache").has(t))return!1;var e=r(this,"cache").get(t).value;return!u(this,e)},o.prototype.get=function(t){return s(this,t,!0)},o.prototype.peek=function(t){return s(this,t,!1)},o.prototype.pop=function(){var t=r(this,"lruList").tail;return t?(c(this,t),t.value):null},o.prototype.del=function(t){c(this,r(this,"cache").get(t))},o.prototype.load=function(t){this.reset();for(var e=Date.now(),n=t.length-1;n>=0;n--){var r=t[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{var o=i-e;o>0&&this.set(r.k,r.v,o)}}},o.prototype.prune=function(){var t=this;r(this,"cache").forEach(function(e,n){s(t,n,!1)})}},{pseudomap:44,util:50,yallist:51}],43:[function(t,e,n){"use strict";function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function a(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){y&&d&&(y=!1,d.length?v=d.concat(v):m=-1,v.length&&u())}function u(){if(!y){var t=o(s);y=!0;for(var e=v.length;e;){for(d=v,v=[];++m<e;)d&&d[m].run();m=-1,e=v.length}d=null,y=!1,a(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var f,h,p=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(t){f=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var d,v=[],y=!1,m=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];v.push(new l(t,e)),1!==v.length||y||o(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],44:[function(t,e,n){(function(n){"use strict";"pseudomap"===n.env.npm_package_name&&"test"===n.env.npm_lifecycle_script&&(n.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||n.env.TEST_PSEUDOMAP?e.exports=t("./pseudomap"):e.exports=Map}).call(this,t("_process"))},{"./pseudomap":45,_process:43}],45:[function(t,e,n){"use strict";function r(t){if(!(this instanceof r))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),t)if(t instanceof r||"function"==typeof Map&&t instanceof Map)t.forEach(function(t,e){this.set(e,t)},this);else{if(!Array.isArray(t))throw new TypeError("invalid argument");t.forEach(function(t){this.set(t[0],t[1])},this)}}function i(t,e){return t===e||t!==t&&e!==e}function o(t,e,n){this.key=t,this.value=e,this._index=n}function a(t,e){for(var n=0,r="_"+e,o=r;u.call(t,o);o=r+n++)if(i(t[o].key,e))return t[o]}function s(t,e,n){for(var r=0,a="_"+e,s=a;u.call(t,s);s=a+r++)if(i(t[s].key,e))return void(t[s].value=n);t.size++,t[s]=new o(e,n,s)}var u=Object.prototype.hasOwnProperty;e.exports=r,r.prototype.forEach=function(t,e){e=e||this,Object.keys(this._data).forEach(function(n){"size"!==n&&t.call(e,this._data[n].value,this._data[n].key)},this)},r.prototype.has=function(t){return!!a(this._data,t)},r.prototype.get=function(t){var e=a(this._data,t);return e&&e.value},r.prototype.set=function(t,e){s(this._data,t,e)},r.prototype.delete=function(t){var e=a(this._data,t);e&&(delete this._data[e._index],this._data.size--)},r.prototype.clear=function(){var t=Object.create(null);t.size=0,Object.defineProperty(this,"_data",{value:t,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(r.prototype,"size",{get:function(){return this._data.size},set:function(t){},enumerable:!0,configurable:!0}),r.prototype.values=r.prototype.keys=r.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},{}],46:[function(t,e,n){"use strict";function r(t,e,n,a,s){for(n=n||0,a=a||t.length-1,s=s||o;a>n;){if(a-n>600){var u=a-n+1,l=e-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),p=Math.max(n,Math.floor(e-l*f/u+h)),d=Math.min(a,Math.floor(e+(u-l)*f/u+h));r(t,e,p,d,s)}var v=t[e],y=n,m=a;for(i(t,n,e),s(t[a],v)>0&&i(t,n,a);y<m;){for(i(t,y,m),y++,m--;s(t[y],v)<0;)y++;for(;s(t[m],v)>0;)m--}0===s(t[n],v)?i(t,n,m):(m++,i(t,m,a)),m<=e&&(n=m+1),e<=m&&(a=m-1)}}function i(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function o(t,e){return t<e?-1:t>e?1:0}e.exports=r},{}],47:[function(t,e,n){"use strict";function r(t,e){return this instanceof r?(this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),void this.clear()):new r(t,e)}function i(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,n,r,i){i||(i=y(null)),i.minX=1/0,i.minY=1/0,i.maxX=-(1/0),i.maxY=-(1/0);for(var o,a=e;a<n;a++)o=t.children[a],s(i,t.leaf?r(o):o);return i}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function p(t,e){var n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function v(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function y(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)}}function m(t,e,n,r,i){for(var o,a=[e,n];a.length;)n=a.pop(),e=a.pop(),n-e<=r||(o=e+Math.ceil((n-e)/r/2)*r,b(t,o,e,n,i),a.push(e,o,o,n))}e.exports=r;var b=t("quickselect");r.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!v(t,e))return n;for(var i,o,a,s,u=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],s=e.leaf?r(a):a,v(t,s)&&(e.leaf?n.push(a):d(t,s)?this._all(a,n):u.push(a));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!v(t,e))return!1;for(var r,i,o,a,s=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],a=e.leaf?n(o):o,v(t,a)){if(e.leaf||d(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=y([]),this},remove:function(t,e){if(!t)return this;for(var n,r,o,a,s=this.data,u=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],n=c.pop(),a=!0),s.leaf&&(o=i(t,s.children,e),o!==-1))return s.children.splice(o,1),l.push(s),this._condense(l),this;a||s.leaf||!d(s,u)?r?(n++,s=r.children[n],a=!1):s=null:(l.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:u,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,a=n-e+1,s=this._maxEntries;if(a<=s)return i=y(t.slice(e,n+1)),o(i,this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),i=y([]),i.leaf=!1,i.height=r;var u,l,c,f,h=Math.ceil(a/s),p=h*Math.ceil(Math.sqrt(s));for(m(t,e,n,p,this.compareMinX),u=e;u<=n;u+=p)for(c=Math.min(u+p-1,n),m(t,u,c,h,this.compareMinY),l=u;l<=c;l+=h)f=Math.min(l+h-1,c),i.children.push(this._build(t,l,f,r-1));return o(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,a,s,u,l,f,p;;){if(r.push(e),e.leaf||r.length-1===n)break;for(f=p=1/0,i=0,o=e.children.length;i<o;i++)a=e.children[i],u=c(a),l=h(t,a)-u,l<p?(p=l,f=u<f?u:f,s=a):l===p&&u<f&&(f=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),s(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),s=y(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=y([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,s,u,l,f,h;for(l=f=1/0,r=e;r<=n-e;r++)i=a(t,0,r,this.toBBox),o=a(t,r,n,this.toBBox),s=p(i,o),u=c(i)+c(o),s<l?(l=s,h=r,f=u<f?u:f):s===l&&u<f&&(f=u,h=r);return h},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:l,o=this._allDistMargin(t,e,n,r),a=this._allDistMargin(t,e,n,i);o<a&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,u=this.toBBox,l=a(t,0,e,u),c=a(t,n-e,n,u),h=f(l)+f(c);for(i=e;i<n-e;i++)o=t.children[i],s(l,t.leaf?u(o):o),h+=f(l);for(i=n-e-1;i>=e;i--)o=t.children[i],s(c,t.leaf?u(o):o),h+=f(c);return h},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)s(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():o(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},{quickselect:46}],48:[function(t,e,n){"use strict";"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],49:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.exports=function(t){return t&&"object"===("undefined"==typeof t?"undefined":r(t))&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8;
}},{}],50:[function(t,e,n){(function(e,r){"use strict";function i(t,e){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(e)?r.showHidden=e:e&&n._extend(r,e),x(r.showHidden)&&(r.showHidden=!1),x(r.depth)&&(r.depth=2),x(r.colors)&&(r.colors=!1),x(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),u(r,t,r.depth)}function o(t,e){var n=i.styles[e];return n?"["+i.colors[n][0]+"m"+t+"["+i.colors[n][1]+"m":t}function a(t,e){return t}function s(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function u(t,e,r){if(t.customInspect&&e&&P(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var i=e.inspect(r,t);return g(i)||(i=u(t,i,r)),i}var o=l(t,e);if(o)return o;var a=Object.keys(e),v=s(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(e)),O(e)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(e);if(0===a.length){if(P(e)){var y=e.name?": "+e.name:"";return t.stylize("[Function"+y+"]","special")}if(_(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(T(e))return t.stylize(Date.prototype.toString.call(e),"date");if(O(e))return c(e)}var m="",b=!1,w=["{","}"];if(d(e)&&(b=!0,w=["[","]"]),P(e)){var x=e.name?": "+e.name:"";m=" [Function"+x+"]"}if(_(e)&&(m=" "+RegExp.prototype.toString.call(e)),T(e)&&(m=" "+Date.prototype.toUTCString.call(e)),O(e)&&(m=" "+c(e)),0===a.length&&(!b||0==e.length))return w[0]+m+w[1];if(r<0)return _(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var E;return E=b?f(t,e,r,v,a):a.map(function(n){return h(t,e,r,v,n,b)}),t.seen.pop(),p(E,m,w)}function l(t,e){if(x(e))return t.stylize("undefined","undefined");if(g(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return b(e)?t.stylize(""+e,"number"):v(e)?t.stylize(""+e,"boolean"):y(e)?t.stylize("null","null"):void 0}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,n,r,i){for(var o=[],a=0,s=e.length;a<s;++a)j(e,String(a))?o.push(h(t,e,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(t,e,n,r,i,!0))}),o}function h(t,e,n,r,i,o){var a,s,l;if(l=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]},l.get?s=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),j(r,i)||(a="["+i+"]"),s||(t.seen.indexOf(l.value)<0?(s=y(n)?u(t,l.value,null):u(t,l.value,n-1),s.indexOf("\n")>-1&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n"))):s=t.stylize("[Circular]","special")),x(a)){if(o&&i.match(/^\d+$/))return s;a=JSON.stringify(""+i),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function p(t,e,n){var r=0,i=t.reduce(function(t,e){return r++,e.indexOf("\n")>=0&&r++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function d(t){return Array.isArray(t)}function v(t){return"boolean"==typeof t}function y(t){return null===t}function m(t){return null==t}function b(t){return"number"==typeof t}function g(t){return"string"==typeof t}function w(t){return"symbol"===("undefined"==typeof t?"undefined":M(t))}function x(t){return void 0===t}function _(t){return E(t)&&"[object RegExp]"===R(t)}function E(t){return"object"===("undefined"==typeof t?"undefined":M(t))&&null!==t}function T(t){return E(t)&&"[object Date]"===R(t)}function O(t){return E(t)&&("[object Error]"===R(t)||t instanceof Error)}function P(t){return"function"==typeof t}function A(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"===("undefined"==typeof t?"undefined":M(t))||"undefined"==typeof t}function R(t){return Object.prototype.toString.call(t)}function S(t){return t<10?"0"+t.toString(10):t.toString(10)}function L(){var t=new Date,e=[S(t.getHours()),S(t.getMinutes()),S(t.getSeconds())].join(":");return[t.getDate(),D[t.getMonth()],e].join(" ")}function j(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k=/%[sdj%]/g;n.format=function(t){if(!g(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(i(arguments[n]));return e.join(" ")}for(var n=1,r=arguments,o=r.length,a=String(t).replace(k,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),s=r[n];n<o;s=r[++n])a+=y(s)||!E(s)?" "+s:" "+i(s);return a},n.deprecate=function(t,i){function o(){if(!a){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),a=!0}return t.apply(this,arguments)}if(x(r.process))return function(){return n.deprecate(t,i).apply(this,arguments)};if(e.noDeprecation===!0)return t;var a=!1;return o};var C,z={};n.debuglog=function(t){if(x(C)&&(C=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!z[t])if(new RegExp("\\b"+t+"\\b","i").test(C)){var r=e.pid;z[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,r,e)}}else z[t]=function(){};return z[t]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=d,n.isBoolean=v,n.isNull=y,n.isNullOrUndefined=m,n.isNumber=b,n.isString=g,n.isSymbol=w,n.isUndefined=x,n.isRegExp=_,n.isObject=E,n.isDate=T,n.isError=O,n.isFunction=P,n.isPrimitive=A,n.isBuffer=t("./support/isBuffer");var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",L(),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!E(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":49,_process:43,inherits:48}],51:[function(t,e,n){"use strict";function r(t){var e=this;if(e instanceof r||(e=new r),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach(function(t){e.push(t)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)e.push(arguments[n]);return e}function i(t,e){t.tail=new a(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function o(t,e){t.head=new a(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function a(t,e,n,r){return this instanceof a?(this.list=r,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,void(n?(n.prev=this,this.next=n):this.next=null)):new a(t,e,n,r)}e.exports=r,r.Node=a,r.create=r,r.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null},r.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},r.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},r.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)i(this,arguments[t]);return this.length},r.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)o(this,arguments[t]);return this.length},r.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail.next=null,this.length--,t}},r.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head.prev=null,this.length--,t}},r.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,r=0;null!==n;r++)t.call(e,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,r=this.length-1;null!==n;r--)t.call(e,n.value,r,this),n=n.prev},r.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},r.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},r.prototype.map=function(t,e){e=e||this;for(var n=new r,i=this.head;null!==i;)n.push(t.call(e,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(t,e){e=e||this;for(var n=new r,i=this.tail;null!==i;)n.push(t.call(e,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(t,e){var n,r=this.head;if(arguments.length>1)n=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=t(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(t,e){var n,r=this.tail;if(arguments.length>1)n=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=t(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},r.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},r.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=0,o=this.head;null!==o&&i<t;i++)o=o.next;for(;null!==o&&i<e;i++,o=o.next)n.push(o.value);return n},r.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=this.length,o=this.tail;null!==o&&i>e;i--)o=o.prev;for(;null!==o&&i>t;i--,o=o.prev)n.push(o.value);return n},r.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=e,this.tail=t,this}},{}],52:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e,n,i,o){r(this,t),this.left=e,this.right=n,this.bottom=i,this.top=o}return i(t,[{key:"width",value:function(){return this.right-this.left}},{key:"height",value:function(){return this.top-this.bottom}},{key:"equals",value:function(t){return this.left===t.left&&this.right===t.right&&this.bottom===t.bottom&&this.top===t.top}},{key:"overlaps",value:function(t){return!(this.left>t.right||this.right<t.left||this.top<t.bottom||this.bottom>t.top)}},{key:"intersection",value:function(e){if(this.overlaps(e))return new t(Math.max(this.left,e.left),Math.min(this.right,e.right),Math.max(this.bottom,e.bottom),Math.min(this.top,e.top))}}]),t}();e.exports=o},{}],53:[function(t,e,n){"use strict";var r=(navigator&&navigator.userAgent||"").toLowerCase(),i=(navigator&&navigator.vendor||"").toLowerCase(),o=function(){return r.match(/(?:firefox|fxios)\/(\d+)/)},a=function(){return/google inc/.test(i)?r.match(/(?:chrome|crios)\/(\d+)/):null},s=function(){return r.match(/(?:msie |trident.+?; rv:)(\d+)/)},u=function(){return r.match(/edge\/(\d+)/)},l=function(){return r.match(/(?:^opera.+?version|opr)\/(\d+)/)},c=function(){return r.match(/version\/(\d+).+?safari/)};e.exports={firefox:o(),chrome:a(),ie:s(),edge:u(),opera:l(),safari:c()}},{}],54:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("./Bounds"),a=function(t,e){return(t%e+e)%e},s=function(){function t(e,n,i){r(this,t),this.z=e,this.x=n,this.y=i,this.hash=this.z+":"+this.x+":"+this.y}return i(t,[{key:"xyz",value:function(){var t=Math.pow(2,this.z);return this.z+"/"+this.x+"/"+(t-1-this.y)}},{key:"tms",value:function(){return this.z+"/"+this.x+"/"+this.y}},{key:"equals",value:function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}},{key:"getAncestor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=Math.pow(2,e);return new t(this.z-e,Math.floor(this.x/n),Math.floor(this.y/n))}},{key:"getDescendants",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=Math.pow(2,e),r=[],i=0;i<n;i++)for(var o=0;o<n;o++)r.push(new t(this.z+e,this.x*n+i,this.y*n+o));return r}},{key:"isAncestorOf",value:function(t){if(this.z>=t.z)return!1;var e=t.z-this.z,n=Math.pow(2,e),r=Math.floor(t.x/n);if(this.x!==r)return!1;var i=Math.floor(t.y/n);return this.y===i}},{key:"isDescendantOf",value:function(t){return t.isAncestorOf(this)}},{key:"normalize",value:function(){var e=Math.pow(2,this.z);return new t(this.z,a(this.x,e),a(this.y,e))}},{key:"getPixelBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.z,n=Math.pow(2,e-this.z),r=t*n,i=this.x*r,a=this.y*r;return new o(Math.round(i),Math.round(i+r-1),Math.round(a),Math.round(a+r-1))}}]),t}();e.exports=s},{"./Bounds":52}],55:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function t(e){r(this,t),this.coord=e,this.data=null,this.err=null};e.exports=i},{}],56:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t,n,o,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;r(this,e);var u=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u.target=t,u.viewPx=o,u.plotPx=a,u.button=n,u.data=s,u}return o(e,t),e}(a);e.exports=s},{"./Event":57}],57:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();r(this,t),this.timestamp=e};e.exports=i},{}],58:[function(t,e,n){"use strict";e.exports={CLICK:"click",DBL_CLICK:"dblclick",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",MOUSE_OVER:"mouseover",MOUSE_OUT:"mouseout",PAN_START:"panstart",PAN:"pan",PAN_END:"panend",ZOOM_START:"zoomstart",ZOOM:"zoom",ZOOM_END:"zoomend",FRAME:"frame",RESIZE:"resize",TILE_REQUEST:"tilerequest",TILE_FAILURE:"tilefailure",TILE_ADD:"tileadd",TILE_DISCARD:"tilediscard",TILE_REMOVE:"tileremove",LOAD:"load",ON_ADD:"onadd",ON_REMOVE:"onremove"}},{}],59:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),e}(a);e.exports=s},{"./Event":57}],60:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.layer=t,n}return o(e,t),e}(a);e.exports=s},{"./Event":57}],61:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t,n,o,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;r(this,e);var u=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u.target=t,u.viewPx=o,u.plotPx=a,u.button=n,u.data=s,u}return o(e,t),e}(a);e.exports=s},{"./Event":57}],62:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.viewport.getPosition(),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.viewport.getPosition();r(this,e);var a=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.plot=t,a.prevPx=n,a.currentPx=o,a}return o(e,t),e}(a);e.exports=s},{"./Event":57}],63:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t,n,o){r(this,e);var a=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.plot=t,a.prevSize=n,a.targetSize=o,a}return o(e,t),e}(a);e.exports=s},{"./Event":57}],64:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t,n){r(this,e);var o=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.layer=t,o.tile=n,o}return o(e,t),e}(a);e.exports=s},{"./Event":57}],65:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=t("./Event"),s=function(t){function e(t,n,o,a){r(this,e);var s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.plot=t,s.prevZoom=n,s.currentZoom=o,s.targetZoom=a,s}return o(e,t),e}(a);e.exports=s},{"./Event":57}],66:[function(t,e,n){"use strict";var r=t("./event/EventType"),i=t("./render/webgl/rtree/CollisionType");e.exports={Bounds:t("./core/Bounds"),Browser:t("./core/Browser"),Coord:t("./core/Coord"),Tile:t("./core/Tile"),CLICK:r.CLICK,DBL_CLICK:r.DBL_CLICK,MOUSE_DOWN:r.MOUSE_DOWN,MOUSE_UP:r.MOUSE_UP,MOUSE_MOVE:r.MOUSE_MOVE,MOUSE_OVER:r.MOUSE_OVER,MOUSE_OUT:r.MOUSE_OUT,PAN_START:r.PAN_START,PAN:r.PAN,PAN_END:r.PAN_END,ZOOM_START:r.ZOOM_START,ZOOM:r.ZOOM,ZOOM_END:r.ZOOM_END,FRAME:r.FRAME,RESIZE:r.RESIZE,TILE_REQUEST:r.TILE_REQUEST,TILE_FAILURE:r.TILE_FAILURE,TILE_ADD:r.TILE_ADD,TILE_DISCARD:r.TILE_DISCARD,TILE_REMOVE:r.TILE_REMOVE,ON_ADD:r.ON_ADD,ON_REMOVE:r.ON_REMOVE,Event:t("./event/Event"),EventType:t("./event/EventType"),ClickEvent:t("./event/ClickEvent"),FrameEvent:t("./event/FrameEvent"),MouseEvent:t("./event/MouseEvent"),PanEvent:t("./event/PanEvent"),ResizeEvent:t("./event/ResizeEvent"),TileEvent:t("./event/TileEvent"),ZoomEvent:t("./event/ZoomEvent"),CIRCLE:i.CIRCLE,RECTANGLE:i.RECTANGLE,Layer:t("./layer/Layer"),Plot:t("./plot/Plot"),Renderer:t("./render/Renderer"),DOMRenderer:t("./render/dom/HTMLRenderer"),HTMLRenderer:t("./render/dom/HTMLRenderer"),SVGRenderer:t("./render/dom/SVGRenderer"),WebGLRenderer:t("./render/webgl/WebGLRenderer"),WebGLTextureRenderer:t("./render/webgl/WebGLTextureRenderer"),WebGLVertexRenderer:t("./render/webgl/WebGLVertexRenderer"),WebGLInteractiveRenderer:t("./render/webgl/WebGLInteractiveRenderer"),PointRenderer:t("./render/webgl/PointRenderer"),ShapeRenderer:t("./render/webgl/ShapeRenderer"),TextureRenderer:t("./render/webgl/TextureRenderer"),InteractiveRenderer:t("./render/webgl/InteractiveRenderer"),Shader:t("./render/webgl/shader/Shader"),Texture:t("./render/webgl/texture/Texture"),TextureArray:t("./render/webgl/texture/TextureArray"),VertexAtlas:t("./render/webgl/vertex/VertexAtlas"),VertexBuffer:t("./render/webgl/vertex/VertexBuffer"),loadBuffer:t("./util/loadBuffer"),loadImage:t("./util/loadImage")}},{"./core/Bounds":52,"./core/Browser":53,"./core/Coord":54,"./core/Tile":55,"./event/ClickEvent":56,"./event/Event":57,"./event/EventType":58,"./event/FrameEvent":59,"./event/MouseEvent":61,"./event/PanEvent":62,"./event/ResizeEvent":63,"./event/TileEvent":64,"./event/ZoomEvent":65,"./layer/Layer":67,"./plot/Plot":69,"./render/Renderer":78,"./render/dom/HTMLRenderer":80,"./render/dom/SVGRenderer":81,"./render/webgl/InteractiveRenderer":82,"./render/webgl/PointRenderer":83,"./render/webgl/ShapeRenderer":84,"./render/webgl/TextureRenderer":85,"./render/webgl/WebGLInteractiveRenderer":86,"./render/webgl/WebGLRenderer":87,"./render/webgl/WebGLTextureRenderer":88,"./render/webgl/WebGLVertexRenderer":89,"./render/webgl/rtree/CollisionType":90,"./render/webgl/shader/Shader":92,"./render/webgl/texture/Texture":95,"./render/webgl/texture/TextureArray":96,"./render/webgl/vertex/VertexAtlas":97,"./render/webgl/vertex/VertexBuffer":98,"./util/loadBuffer":99,"./util/loadImage":100}],67:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("lodash/defaultTo"),u=t("events"),l=t("../plot/Request"),c=t("../event/EventType"),f=t("../event/LayerEvent"),h=t("./TilePyramid"),p=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderer?n.renderers=[t.renderer]:n.renderers=s(t.renderers,[]),n.opacity=s(t.opacity,1),n.hidden=s(t.hidden,!1),n.muted=s(t.muted,!1),n.pyramid=new h(n,t),n.plot=null,n}return o(e,t),a(e,[{key:"onAdd",value:function(t){var e=this;if(!t)throw"No plot argument provided";return this.plot=t,this.renderers.forEach(function(t){t.onAdd(e)}),this.refresh(),this.emit(c.ON_ADD,new f(this)),this}},{key:"onRemove",value:function(t){var e=this;if(!t)throw"No plot argument provided";return this.renderers.forEach(function(t){t.onRemove(e)}),this.plot=null,this.pyramid.clear(),this.emit(c.ON_REMOVE,new f(this)),this}},{key:"addRenderer",value:function(t){if(!t)throw"No renderer argument provided";if(this.renderers.indexOf(t)!==-1)throw"Provided renderer is already attached to the layer";return this.renderers.push(t),this.plot&&t.onAdd(this),this}},{key:"removeRenderer",value:function(t){if(!t)throw"No renderer argument provided";var e=this.renderers.indexOf(t);if(e===-1)throw"Provided renderer is not attached to the layer";return this.renderers.splice(e,1),this.plot&&t.onRemove(this),this}},{key:"show",value:function(){return this.hidden=!1,this}},{key:"hide",value:function(){return this.hidden=!0,this}},{key:"mute",value:function(){return this.muted=!0,this}},{key:"unmute",value:function(){this.muted&&(this.muted=!1,this.plot&&l.requestTiles(this.plot))}},{key:"enable",value:function(){this.show(),this.unmute()}},{key:"disable",value:function(){this.hide(),this.mute()}},{key:"draw",value:function(t){if(!this.hidden)return this.renderers.forEach(function(e){e.draw(t)}),this}},{key:"refresh",value:function(){this.pyramid.clear(),l.requestBaseTile(this);var t=this.plot.zoomAnimation;return t?l.zoomRequest(this.plot,t.targetViewport,t.targetZoom):l.requestTiles(this.plot),this}},{key:"requestTile",value:function(t,e){e(null,null)}},{key:"requestTiles",value:function(t){return this.muted||this.pyramid.requestTiles(t),this}}]),e}(u);e.exports=p},{"../event/EventType":58,"../event/LayerEvent":60,"../plot/Request":70,"./TilePyramid":68,events:1,"lodash/defaultTo":24}],68:[function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("lodash/defaultTo"),s=t("lodash/throttle"),u=t("lru-cache"),l=t("../core/Tile"),c=t("../event/EventType"),f=t("../event/TileEvent"),h=256,p=4,d=200,v=function(t,e){var n=Math.pow(2,t.z-e.z),r=1/n,i={x:e.x*n,y:e.y*n};return{x:(t.x-i.x)*r,y:(t.y-i.y)*r,extent:r}},y=function(t,e){if(e.coord.z<t.persistantLevels){if(t.persistants.has(e.coord.hash))throw"Tile of coord "+e.coord.hash+" already exists in the pyramid";t.persistants.set(e.coord.hash,e)}else{if(t.tiles.has(e.coord.hash))throw"Tile of coord "+e.coord.hash+" already exists in the pyramid";t.tiles.set(e.coord.hash,e)}t.levels.has(e.coord.z)||t.levels.set(e.coord.z,[]),t.levels.get(e.coord.z).push(e),t.layer.emit(c.TILE_ADD,new f(t.layer,e))},m=function(t,e){if(e.coord.z<t.persistantLevels)throw"Tile of coord "+e.coord.hash+" is flagged as persistant and cannot be removed";if(!t.tiles.has(e.coord.hash))throw"Tile of coord "+e.coord.hash+" does not exists in the pyramid";var n=t.levels.get(e.coord.z);n.splice(n.indexOf(e),1),0===n.length&&t.levels.delete(e.coord.z),t.layer.emit(c.TILE_REMOVE,new f(t.layer,e))},b=function(t){return 1/3*(Math.pow(4,t)-1)},g=function(t){0===t.pending.size&&t.emitLoad(new f(t.layer,null))},w=function(t,e){var n=null,r=0;t.zoomAnimation?(n=t.zoomAnimation.targetViewport.getCenter(),r=t.zoomAnimation.targetZoom):(n=t.viewport.getCenter(),r=t.zoom);var i=t.tileSize*Math.pow(2,r-Math.round(r));return n.x/=i,n.y/=i,e.sort(function(t,e){var r=n.x-(t.x+.5),i=n.y-(t.y+.5),o=n.x-(e.x+.5),a=n.y-(e.y+.5),s=r*r+i*i,u=o*o+a*a;return t.d=s,e.d=u,s-u}),e},x=function(t){var e=new Map;return t.filter(function(t){return!e.has(t.hash)&&e.set(t.hash,!0)})},_=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i(this,t),!e)throw"No layer parameter provided";this.cacheSize=a(r.cacheSize,h),this.persistantLevels=a(r.persistantLevels,p),this.totalCapacity=this.cacheSize+b(this.persistantLevels),this.layer=e,this.levels=new Map,this.persistants=new Map,this.pending=new Map,this.stale=new Map,this.tiles=new u({max:this.cacheSize,dispose:function(t,e){m(n,e)}}),this.emitLoad=s(function(t){n.layer.emit(c.LOAD,t)},d)}return o(t,[{key:"clear",value:function(){var t=this;this.stale=this.pending,this.levels=new Map,this.persistants=new Map,this.pending=new Map,this.tiles=new u({max:this.cacheSize,dispose:function(e,n){m(t,n)}})}},{key:"has",value:function(t){return t.z<this.persistantLevels?this.persistants.has(t.hash):this.tiles.has(t.hash)}},{key:"isPending",value:function(t){return this.pending.has(t.hash)}},{key:"get",value:function(t){return t.z<this.persistantLevels?this.persistants.get(t.hash):this.tiles.get(t.hash)}},{key:"getClosestAncestor",value:function(t){for(var e=[].concat(r(this.levels.keys())).sort(function(t,e){return e-t}).filter(function(e){return e<t.z}),n=0;n<e.length;n++){var i=e[n],o=t.getAncestor(t.z-i);if(this.has(o))return o}}},{key:"isStale",value:function(t){var e=t.normalize();if(this.stale.has(e.hash))return this.stale.delete(e.hash),!0;var n=this.layer.plot;if(!n)return!0;var r=n.zoomAnimation,i=r?r.targetViewport:n.viewport,o=r?r.targetZoom:n.zoom;return!i.isInView(n.tileSize,t,o)}},{key:"requestTiles",value:function(t){var e=this;t=x(t),t=t.filter(function(t){var n=t.normalize();return!e.has(n)&&!e.isPending(n)}),
t=w(this.layer.plot,t),t.forEach(function(t){var n=t.normalize();if(!e.has(n)&&!e.isPending(n)){var r=new l(n);e.pending.set(n.hash,r),e.layer.emit(c.TILE_REQUEST,new f(e.layer,r)),e.layer.requestTile(n,function(i,o){return e.pending.delete(n.hash),null!==i?(r.err=i,e.layer.emit(c.TILE_FAILURE,new f(e.layer,r)),void g(e)):(r.data=o,e.isStale(t)?(e.layer.emit(c.TILE_DISCARD,new f(e.layer,r)),void g(e)):(y(e,r),void g(e)))})}})}},{key:"getAvailableLOD",value:function(t){var e=t.normalize();if(this.has(e))return{coord:t,tile:this.get(e),offset:{x:0,y:0,extent:1}};var n=this.getClosestAncestor(e);return n?{coord:t,tile:this.get(n),offset:v(e,n)}:void 0}}]),t}();e.exports=_},{"../core/Tile":55,"../event/EventType":58,"../event/TileEvent":64,"lodash/defaultTo":24,"lodash/throttle":40,"lru-cache":42}],69:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("lodash/clamp"),u=t("lodash/defaultTo"),l=t("events"),c=t("../event/EventType"),f=t("../event/FrameEvent"),h=t("../event/ResizeEvent"),p=t("../render/webgl/texture/RenderBuffer"),d=t("./Request"),v=t("./Viewport"),y=t("./handler/ClickHandler"),m=t("./handler/MouseHandler"),b=t("./handler/PanHandler"),g=t("./handler/ZoomHandler"),w=function(t){var e={width:t.container.offsetWidth,height:t.container.offsetHeight},n={width:t.viewport.width,height:t.viewport.height},r=t.viewport.getCenter();n.width===e.width&&n.height===e.height&&t.pixelRatio===window.devicePixelRatio||(t.pixelRatio=window.devicePixelRatio,t.canvas.style.width=e.width+"px",t.canvas.style.height=e.height+"px",t.canvas.width=e.width*t.pixelRatio,t.canvas.height=e.height*t.pixelRatio,t.renderBuffer.resize(e.width*t.pixelRatio,e.height*t.pixelRatio),t.viewport.width=e.width,t.viewport.height=e.height,t.viewport.centerOn(r),d.requestTiles(t),t.emit(c.RESIZE,new h(t,n,e)))},x=function(t){if(t.wraparound){var e=Math.pow(2,t.zoom),n=e*t.tileSize,r=Math.ceil(t.viewport.width/n),i=0,o=n-1;t.viewport.x>o&&(t.viewport.x-=n*r,t.panAnimation&&(t.panAnimation.start.x-=n*r)),t.viewport.x+t.viewport.width<i&&(t.viewport.x+=n*r,t.panAnimation&&(t.panAnimation.start.x+=n*r))}},_=function t(e){var n=Date.now();e.emit(c.FRAME,new f(n)),w(e);var r=e.gl;r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.viewport(0,0,e.viewport.width*window.devicePixelRatio,e.viewport.height*window.devicePixelRatio),e.zoomAnimation&&e.zoomAnimation.updatePlot(e,n),e.panAnimation&&(e.panAnimation.updatePlot(e,n),d.panRequest(e)),x(e),e.layers.forEach(function(t){t.draw(n)}),e.frameRequest=requestAnimationFrame(function(){t(e)})},E=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var o=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(o.container=document.querySelector(t),!o.container)throw"Element could not be found for selector "+t;o.canvas=document.createElement("canvas"),o.canvas.style.width=o.container.offsetWidth+"px",o.canvas.style.height=o.container.offsetHeight+"px",o.canvas.width=o.container.offsetWidth*window.devicePixelRatio,o.canvas.height=o.container.offsetHeight*window.devicePixelRatio,o.container.appendChild(o.canvas);try{o.gl=o.canvas.getContext("webgl",n)}catch(t){throw"Unable to create a WebGLRenderingContext, please ensure your browser supports WebGL"}o.renderBuffer=new p(o.gl,o.canvas.width,o.canvas.height),o.viewport=new v({width:o.canvas.offsetWidth,height:o.canvas.offsetHeight}),o.pixelRatio=window.devicePixelRatio,o.tileSize=u(n.tileSize,256),o.minZoom=u(n.minZoom,0),o.maxZoom=u(n.maxZoom,30),o.zoom=u(n.zoom,0),o.zoom=s(o.zoom,o.minZoom,o.maxZoom);var a=u(n.center,Math.pow(2,o.zoom)*o.tileSize/2);return o.viewport.centerOn({x:a,y:a}),o.wraparound=u(n.wraparound,!1),o.handlers=new Map,o.handlers.set("click",new y(o,n)),o.handlers.set("mouse",new m(o,n)),o.handlers.set("pan",new b(o,n)),o.handlers.set("zoom",new g(o,n)),o.handlers.forEach(function(t){t.enable()}),o.layers=[],o.frameRequest=null,_(o),o}return o(e,t),a(e,[{key:"destroy",value:function(){var t=this;return cancelAnimationFrame(this.frameRequest),this.frameRequest=null,this.gl=null,this.canvas=null,this.container=null,this.renderBuffer=null,this.handlers.forEach(function(t){t.disable()}),this.layers.forEach(function(e){t.removeLayer(e)}),this}},{key:"addLayer",value:function(t){if(!t)throw"No layer argument provided";if(this.layers.indexOf(t)!==-1)throw"Provided layer is already attached to the plot";return this.layers.push(t),t.onAdd(this),this}},{key:"removeLayer",value:function(t){if(!t)throw"No layer argument provided";var e=this.layers.indexOf(t);if(e===-1)throw"Provided layer is not attached to the plot";return this.layers.splice(e,1),t.onRemove(this),this}},{key:"mouseToViewPx",value:function(t){return{x:t.clientX,y:this.viewport.height-t.clientY}}},{key:"mouseToPlotPx",value:function(t){return this.viewPxToPlotPx(this.mouseToViewPx(t))}},{key:"viewPxToPlotPx",value:function(t){return{x:this.viewport.x+t.x,y:this.viewport.y+t.y}}},{key:"plotPxToViewPx",value:function(t){return{x:t.x-this.viewport.x,y:t.y-this.viewport.y}}}]),e}(l);e.exports=E},{"../event/EventType":58,"../event/FrameEvent":59,"../event/ResizeEvent":63,"../render/webgl/texture/RenderBuffer":94,"./Request":70,"./Viewport":71,"./handler/ClickHandler":74,"./handler/MouseHandler":75,"./handler/PanHandler":76,"./handler/ZoomHandler":77,events:1,"lodash/clamp":22,"lodash/defaultTo":24}],70:[function(t,e,n){"use strict";var r=t("lodash/throttle"),i=t("../core/Coord"),o=400,a=100,s=function(t){t.requestTiles([new i(0,0,0)])},u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.viewport,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.zoom,r=e.getVisibleCoords(t.tileSize,n,Math.round(n),t.wraparound);t.layers.forEach(function(t){t.requestTiles(r)})};e.exports={requestTiles:u,requestBaseTile:s,panRequest:r(u,a),zoomRequest:r(u,o)}},{"../core/Coord":54,"lodash/throttle":40}],71:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../core/Bounds"),a=t("../core/Coord"),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t),this.x=e.x?e.x:0,this.y=e.y?e.y:0,this.width=e.width?Math.round(e.width):0,this.height=e.height?Math.round(e.height):0}return i(t,[{key:"getPixelBounds",value:function(){return new o(this.x,this.x+this.width-1,this.y,this.y+this.height-1)}},{key:"getTileBounds",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=Math.pow(2,e-n),i=t*r;return new o(Math.floor(this.x/i),Math.ceil((this.x+this.width)/i-1),Math.floor(this.y/i),Math.ceil((this.y+this.height)/i-1))}},{key:"getVisibleCoords",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.getTileBounds(t,e,n),s=Math.pow(2,n),u=0,l=s-1,c=new o(r?-(1/0):u,r?1/0:l,u,l);if(!i.overlaps(c))return[];for(var f=r?i.left:Math.max(u,i.left),h=r?i.right:Math.min(l,i.right),p=Math.max(u,i.bottom),d=Math.min(l,i.top),v=[],y=f;y<=h;y++)for(var m=p;m<=d;m++)v.push(new a(n,y,m));return v}},{key:"isInView",value:function(t,e,n){var r=this.getPixelBounds(),i=e.getPixelBounds(t,n);return r.overlaps(i)}},{key:"zoomFromPlotCenter",value:function(e,n,r){var i=Math.pow(2,n),o=Math.pow(2,r),a=e*(o-i)/2,s=new t({width:this.width,height:this.height,x:this.x+a,y:this.y+a});return s}},{key:"zoomFromPlotPx",value:function(e,n,r,i){var o=Math.pow(2,n),a=Math.pow(2,r),s=e*(a-o)/2,u=e*o/2,l={x:i.x-u,y:i.y-u},c=Math.pow(2,r-n),f={x:l.x*c-l.x,y:l.y*c-l.y},h=new t({width:this.width,height:this.height,x:this.x+s+f.x,y:this.y+s+f.y});return h}},{key:"getPosition",value:function(){return{x:this.x,y:this.y}}},{key:"getCenter",value:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}},{key:"centerOn",value:function(t){this.x=t.x-this.width/2,this.y=t.y-this.height/2}}]),t}();e.exports=s},{"../core/Bounds":52,"../core/Coord":54}],72:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../../event/EventType"),a=t("../../event/PanEvent"),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t),this.timestamp=Date.now(),this.start=e.start,this.delta=e.delta,this.end={x:this.start.x+this.delta.x,y:this.start.y+this.delta.y},this.easing=e.easing,this.duration=e.duration}return i(t,[{key:"updatePlot",value:function(t,e){var n=Math.min(1,(e-this.timestamp)/(this.duration||1)),r=1-Math.pow(1-n,1/this.easing),i=t.viewport.getPosition(),s={x:this.start.x+this.delta.x*r,y:this.start.y+this.delta.y*r};t.viewport.x=s.x,t.viewport.y=s.y;var u=new a(t,i,s);n<1?t.emit(o.PAN,u):(t.emit(o.PAN_END,u),t.panAnimation=null)}}]),t}();e.exports=s},{"../../event/EventType":58,"../../event/PanEvent":62}],73:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../../event/EventType"),a=t("../../event/ZoomEvent"),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t),this.timestamp=Date.now(),this.duration=e.duration,this.prevZoom=e.prevZoom,this.targetZoom=e.targetZoom,this.prevViewport=e.prevViewport,this.targetViewport=e.targetViewport,this.targetPx=e.targetPx}return i(t,[{key:"updatePlot",value:function(t,e){var n=Math.min(1,(e-this.timestamp)/(this.duration||1)),r=this.targetZoom-this.prevZoom,i=this.prevZoom+r*n;t.zoom=i,t.viewport=this.prevViewport.zoomFromPlotPx(t.tileSize,this.prevZoom,t.zoom,this.targetPx);var s=new a(t,this.prevZoom,t.zoom,this.targetZoom);n<1?t.emit(o.ZOOM,s):(t.emit(o.ZOOM_END,s),t.zoomAnimation=null)}}]),t}();e.exports=s},{"../../event/EventType":58,"../../event/ZoomEvent":65}],74:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../../event/EventType"),a=t("../../event/ClickEvent"),s=15,u=function(t){if(t.which){if(1===t.which)return"left";if(2===t.which)return"middle";if(3===t.which)return"right"}return 0===t.button?"left":1===t.button?"middle":2===t.button?"right":void 0},l=function(t,e){return new a(t,u(e),t.mouseToViewPx(e),t.mouseToPlotPx(e))},c=function(){function t(e){r(this,t),this.plot=e,this.enabled=!1}return i(t,[{key:"enable",value:function(){var t=this;if(this.enabled)throw"Handler is already enabled";var e=this.plot,n=null;this.mousedown=function(t){n=e.mouseToViewPx(t)},this.mouseup=function(r){if(n){var i=e.mouseToViewPx(r),a={x:n.x-i.x,y:n.y-i.y},u=a.x*a.x+a.y*a.y;u<s*s&&t.plot.emit(o.CLICK,l(e,r)),n=null}},this.dblclick=function(n){t.plot.emit(o.DBL_CLICK,l(e,n))},e.container.addEventListener("mousedown",this.mousedown),e.container.addEventListener("mouseup",this.mouseup),e.container.addEventListener("dblclick",this.dblclick),this.enabled=!0}},{key:"disable",value:function(){if(this.enabled)throw"Handler is already disabled";this.plot.container.removeEventListener("mousedown",this.mousedown),this.plot.container.removeEventListener("mouseup",this.mouseup),this.plot.container.removeEventListener("dblclick",this.dblclick),this.mousedown=null,this.mouseup=null,this.dblclick=null,this.enabled=!1}}]),t}();e.exports=c},{"../../event/ClickEvent":56,"../../event/EventType":58}],75:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("../../event/EventType"),a=t("../../event/MouseEvent"),s=function(t){if(t.which){if(1===t.which)return"left";if(2===t.which)return"middle";if(3===t.which)return"right"}return 0===t.button?"left":1===t.button?"middle":2===t.button?"right":void 0},u=function(t,e){return new a(t,s(e),t.mouseToViewPx(e),t.mouseToPlotPx(e))},l=function(){function t(e){r(this,t),this.plot=e,this.enabled=!1}return i(t,[{key:"enable",value:function(){var t=this;if(this.enabled)throw"Handler is already enabled";var e=this.plot;this.mousedown=function(n){t.plot.emit(o.MOUSE_DOWN,u(e,n))},this.mouseup=function(n){t.plot.emit(o.MOUSE_UP,u(e,n))},this.mousemove=function(n){t.plot.emit(o.MOUSE_MOVE,u(e,n))},this.mouseover=function(n){t.plot.emit(o.MOUSE_OVER,u(e,n))},this.mouseout=function(n){t.plot.emit(o.MOUSE_OUT,u(e,n))},e.container.addEventListener("mousedown",this.mousedown),e.container.addEventListener("mouseup",this.mouseup),e.container.addEventListener("mousemove",this.mousemove),e.container.addEventListener("mouseover",this.mouseover),e.container.addEventListener("mouseout",this.mouseout),this.enabled=!0}},{key:"disable",value:function(){if(this.enabled)throw"Handler is already disabled";this.plot.container.removeEventListener("mousedown",this.mousedown),this.plot.container.removeEventListener("mouseup",this.mouseup),this.plot.container.removeEventListener("mousemove",this.mousemove),this.plot.container.removeEventListener("mouseover",this.mouseover),this.plot.container.removeEventListener("mouseout",this.mouseout),this.mousedown=null,this.mouseup=null,this.mousemove=null,this.mouseover=null,this.mouseout=null,this.enabled=!1}}]),t}();e.exports=l},{"../../event/EventType":58,"../../event/MouseEvent":61}],76:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash/defaultTo"),a=t("../animation/PanAnimation"),s=t("../../event/EventType"),u=t("../../event/PanEvent"),l=t("./../Request"),c=50,f=!0,h=.2,p=3400,d=800,v=function(t,e){if(!t.zoomAnimation){var n=t.viewport.getPosition(),r={x:n.x+=e.x,y:n.y+=e.y};t.viewport.x=r.x,t.viewport.y=r.y,l.panRequest(t),t.emit(s.PAN,new u(t,n,r))}},y=function(t){return t.which?3===t.which:2===t.button},m=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t),this.inertia=o(n.inertia,f),this.inertiaEasing=o(n.inertiaEasing,h),this.inertiaDeceleration=o(n.inertiaDeceleration,p),this.plot=e,this.enabled=!1}return i(t,[{key:"enable",value:function(){var t=this;if(this.enabled)throw"Handler is already enabled";var e=this.plot,n=!1,r=null,i=null,o=[],l=[];this.mousedown=function(a){y(a)||(n=!0,r=e.mouseToViewPx(a),i=Date.now(),t.inertia&&(e.panAnimation=null,o=[],l=[]))},this.mousemove=function(a){if(n){var f=e.mouseToViewPx(a),h=Date.now();if(0===o.length){var p={x:r.x,y:r.y},d={x:f.x,y:f.y};e.emit(s.PAN_START,new u(e,p,d))}t.inertia&&(o.push(f),l.push(h),h-l[0]>c&&(o.shift(),l.shift()));var y={x:r.x-f.x,y:r.y-f.y};v(e,y),i=h,r=f}},this.mouseup=function(f){if(n=!1,!y(f)&&0!==o.length){if(!t.inertia)return void e.emit(s.PAN_END,new u(e));for(var h=Date.now();h-l[0]>c;)o.shift(),l.shift();if(l.length<2)return void e.emit(s.PAN_END,new u(e));var p=t.inertiaDeceleration,d=t.inertiaEasing,v={x:r.x-o[0].x,y:r.y-o[0].y},m=(i-l[0]||1)/1e3,b={x:v.x*(d/m),y:v.y*(d/m)},g=Math.sqrt(b.x*b.x+b.y*b.y),w=g/(p*d),x={x:Math.round(b.x*(-w/2)),y:Math.round(b.y*(-w/2))},_={x:e.viewport.x,y:e.viewport.y};e.panAnimation=new a({start:_,delta:x,easing:d,duration:1e3*w})}},this.plot.container.addEventListener("mousedown",this.mousedown),document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup),this.enabled=!0}},{key:"disable",value:function(){if(!this.enabled)throw"Handler is already disabled";this.plot.container.removeEventListener("mousedown",this.mousedown),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup),this.mousedown=null,this.mousemove=null,this.mouseup=null,this.enabled=!1}},{key:"panTo",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.plot,r=n.viewport.getCenter(),i={x:t.x-r.x,y:t.y-r.y};e?(n.emit(s.PAN_START,new u(n)),n.panAnimation=new a({start:n.viewport.getPosition(),delta:i,easing:this.inertiaEasing,duration:d})):(n.emit(s.PAN_START,new u(n)),v(n,i),n.emit(s.PAN_END,new u(n)))}}]),t}();e.exports=m},{"../../event/EventType":58,"../../event/PanEvent":62,"../animation/PanAnimation":72,"./../Request":70,"lodash/defaultTo":24}],77:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash/clamp"),a=t("lodash/defaultTo"),s=t("../../core/Browser"),u=t("../../event/EventType"),l=t("../../event/ZoomEvent"),c=t("../animation/ZoomAnimation"),f=t("../Request"),h=t("../Viewport"),p=300,d=250,v=4,y=100,m=!1,b=Date.now(),g=function(t,e){var n=Date.now(),r=n-b;return b=n,e%4.000244140625!==0&&(Math.abs(e)<4||(!t||0===t.duration)&&r<40)},w=function(t,e,n,r){var i=t/n;return e||(i=t>0?Math.ceil(i):Math.floor(i)),o(i,-r,r)},x=function(t,e,n,r,i){var a=void 0;return a=n?n.targetZoom+t:e+t,o(a,r,i)},_=function(t,e,n,r){var i=x(n,t.zoom,t.zoomAnimation,t.minZoom,t.maxZoom);if(i!==t.zoom){var o=t.viewport.zoomFromPlotPx(t.tileSize,t.zoom,i,e);t.panAnimation=null,t.zoomAnimation=new c({duration:r,prevZoom:t.zoom,targetZoom:i,prevViewport:new h(t.viewport),targetViewport:o,targetPx:e}),f.zoomRequest(t,o,i),t.emit(u.ZOOM_START,new l(t,t.zoom,t.zoom,i))}},E=function(t,e,n,r,i){if(0!==r){var o=w(r,i,t.deltaPerZoom,t.maxConcurrentZooms),a=t.zoomDuration;i&&g(e.zoomAnimation,r)&&(a=0),_(e,n,o,a)}},T=function(t,e){return 0===e.deltaMode?s.firefox?-e.deltaY/t.pixelRatio:-e.deltaY:1===e.deltaMode?20*-e.deltaY:60*-e.deltaY},O=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t),this.continuousZoom=a(n.continuousZoom,m),this.zoomDuration=a(n.zoomDuration,d),this.maxConcurrentZooms=a(n.maxConcurrentZooms,v),this.deltaPerZoom=a(n.deltaPerZoom,p),this.zoomDebounce=a(n.zoomDebounce,y),this.plot=e,this.enabled=!1}return i(t,[{key:"enable",value:function(){var t=this;if(this.enabled)throw"Handler is already enabled";var e=this.plot,n=0,r=null,i=null;this.dblclick=function(n){var r=e.mouseToPlotPx(n);_(e,r,1,t.zoomDuration)},this.wheel=function(o){var a=T(e,o);if(t.continuousZoom||!(Math.abs(a)<4)){if(n+=a,t.continuousZoom){var s=e.mouseToPlotPx(o);E(t,e,s,n,!0),n=0}else i=o,r||(r=setTimeout(function(){var o=e.mouseToPlotPx(i);E(t,e,o,n,!1),n=0,r=null,i=null},t.zoomDebounce));o.preventDefault(),o.stopPropagation()}},this.plot.container.addEventListener("dblclick",this.dblclick),this.plot.container.addEventListener("wheel",this.wheel),this.enabled=!0}},{key:"disable",value:function(){if(this.enabled)throw"Handler is already disabled";this.plot.container.removeEventListener("dblclick",this.dblclick),this.plot.container.removeEventListener("wheel",this.wheel),this.dblclick=null,this.wheel=null,this.enabled=!1}},{key:"zoomTo",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.plot,i=t-r.zoom;n?_(r,e,i,this.zoomDuration):_(r,e,i,0)}}]),t}();e.exports=O},{"../../core/Browser":53,"../../event/EventType":58,"../../event/ZoomEvent":65,"../Request":70,"../Viewport":71,"../animation/ZoomAnimation":73,"lodash/clamp":22,"lodash/defaultTo":24}],78:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("events"),u=function(t){function e(){r(this,e);var t=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.layer=null,t.handlers=null,t}return o(e,t),a(e,[{key:"onAdd",value:function(t){if(!t)throw"No layer provided as argument";return this.layer=t,this.handlers=new Map,this}},{key:"onRemove",value:function(t){if(!t)throw"No layer provided as argument";return this.layer=null,this.handlers=null,this}},{key:"draw",value:function(){return this}}]),e}(s);e.exports=u},{events:1}],79:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},u=t("../Renderer"),l=400,c=400,f=40,h=400,p=function(t){return t.viewport.getVisibleCoords(t.tileSize,t.zoom,Math.round(t.zoom),t.wraparound)},d=function(t,e){var n=p(t),r=new Map;n.forEach(function(t){r.set(t.hash,t)});var i=new Map;return e.forEach(function(t,e){r.has(e)||i.set(e,t)}),i},v=function(t,e){var n=p(t),r=new Map;return n.forEach(function(t){var n=t.normalize(),i=e.get(n);i&&r.set(t.hash,{coord:t,tile:i})}),r},y=function(t){function e(){r(this,e);var t=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.tiles=null,t.drawTimeout=null,t.eraseTimeout=null,t}return o(e,t),a(e,[{key:"onAdd",value:function(t){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.tiles=new Map,this.container=this.createContainer(),this.layer.plot.container.appendChild(this.container),this}},{key:"onRemove",value:function(t){return this.layer.plot.container.removeChild(this.container),this.tiles=null,this.container=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"createContainer",value:function(){throw"`createContainer` not implemented"}},{key:"createTile",value:function(){throw"`createTile` not implemented"}},{key:"draw",value:function(){var t=this,e=this.layer,n=e.pyramid,r=e.plot,i=r.tileSize,o=this.tiles,a=this.container,s=r.plotPxToViewPx({x:0,y:0}),u=Math.pow(2,r.zoom-Math.round(r.zoom));1===u?a.style.transform="translate3d("+s.x+"px,"+-s.y+"px,0)":a.style.transform="translate3d("+s.x+"px,"+-s.y+"px,0) scale("+u+")",a.style.opacity!==e.opacity&&(a.style.opacity=e.opacity);var p=d(r,o);return o.size>0&&p.size===o.size?(this.eraseTimeout&&(clearTimeout(this.eraseTimeout),this.eraseTimeout=null),o.clear(),a.innerHTML=""):this.eraseTimeout||(this.eraseTimeout=setTimeout(function(){t.eraseTimeout=null,d(r,o).forEach(function(t,e){o.delete(e),a.removeChild(t)})},c)),this.drawTimeout||(this.drawTimeout=setTimeout(function(){t.drawTimeout=null;var e=document.createDocumentFragment();v(r,n).forEach(function(n,r){o.has(r)||!function(){var a=t.createTile(n.coord.x*i,n.coord.y*i,i);a.style.transition="opacity "+h+"ms",a.style.opacity="0.0",t.drawTile(a,n.tile),e.append(a),setTimeout(function(){a.style.opacity=1},f),o.set(r,a)}()}),a.appendChild(e)},l)),this}},{key:"clear",value:function(){return this.container.innerHTML="",this.tiles.clear(),this}},{key:"redraw",value:function(){return this.clear(),this.draw(),this}},{key:"drawTile",value:function(){}}]),e}(u);e.exports=y},{"../Renderer":78}],80:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("./DOMRenderer"),u=function(t){function e(){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,t),a(e,[{key:"createContainer",value:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.left=0,t.style.bottom=0,t}},{key:"createTile",value:function(t,e,n){var r=document.createElement("div");return r.style.position="absolute",r.style.width=n+"px",r.style.height=n+"px",r.style.left=t+"px",r.style.bottom=e+"px",r}}]),e}(s);e.exports=u},{"./DOMRenderer":79}],81:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("./DOMRenderer"),u="http://www.w3.org/2000/svg",l=20,c=function(t){function e(){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,t),a(e,[{key:"createContainer",value:function(){var t=document.createElementNS(u,"svg");return t.style.position="absolute",t.style.overflow="visible",t.style.left=0,t.style.bottom=-l,t.setAttribute("width",l),t.setAttribute("height",l),t}},{key:"createTile",value:function(t,e,n){var r=document.createElementNS(u,"g");return r.setAttribute("transform","translate("+t+","+(-e-n)+")"),r}}]),e}(s);e.exports=c},{"./DOMRenderer":79}],82:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},u=t("lodash/defaultTo"),l=t("./vertex/VertexBuffer"),c=t("./WebGLInteractiveRenderer"),f=2,h=4,p={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute float aRadius;\n\t\tuniform float uRadiusOffset;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform float uPixelRatio;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * uScale) + uTileOffset;\n\t\t\tgl_PointSize = (aRadius + uRadiusOffset) * uScale * 2.0 * uPixelRatio;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t#extension GL_OES_standard_derivatives : enable\n\t\t#endif\n\t\tprecision highp float;\n\t\tuniform vec4 uColor;\n\t\tvoid main() {\n\t\t\tvec2 cxy = 2.0 * gl_PointCoord - 1.0;\n\t\t\tfloat radius = dot(cxy, cxy);\n\t\t\tfloat alpha = 1.0;\n\t\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t\tfloat delta = fwidth(radius);\n\t\t\t\talpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, radius);\n\t\t\t#else\n\t\t\t\tif (radius > 1.0) {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\tgl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\n\t\t}\n\t\t"},d=function(t){var e=new Float32Array(2);return e[0]=0,e[1]=0,new l(t,e,{0:{size:2,type:"FLOAT",byteOffset:0}},{mode:"POINTS",count:1})},v=function(t,e,n,r,i,o){t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),n.setUniform("uColor",o),n.setUniform("uRadiusOffset",0),e.bind(),i.forEach(function(t){n.setUniform("uScale",t.scale),n.setUniform("uTileOffset",t.tileOffset),e.draw(t.hash,"POINTS")}),e.unbind();
},y=function(t,e,n,r,i,o,a,s){var u=o.tile.coord,l=Math.pow(2,i.zoom-u.z),c=[u.x*l*i.tileSize+l*o.x-i.viewport.x,u.y*l*i.tileSize+l*o.y-i.viewport.y];n.setUniform("uTileOffset",c),n.setUniform("uScale",l),n.setUniform("uColor",a),n.setUniform("uRadiusOffset",s+o.radius),e.bind(),e.draw(),e.unbind()},m=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.shader=null,n.point=null,n.atlas=null,n.xField=u(t.xField,"x"),n.yField=u(t.yField,"y"),n.radiusField=u(t.radiusField,"radius"),n.color=u(t.color,[1,.4,.1,.8]),n}return o(e,t),a(e,[{key:"onAdd",value:function(t){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.ext=this.gl.getExtension("OES_standard_derivatives"),this.point=d(this.gl),this.shader=this.createShader(p),this.atlas=this.createVertexAtlas({0:{size:2,type:"FLOAT"},1:{size:1,type:"FLOAT"}}),this}},{key:"onRemove",value:function(t){return this.destroyVertexAtlas(this.atlas),this.atlas=null,this.shader=null,this.point=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"addTile",value:function(t,e){for(var n=e.coord,r=e.data,i=this.layer.plot.tileSize,o=n.x*i,a=n.y*i,s=this.xField,u=this.yField,l=this.radiusField,c=new Array(r.length),f=new Float32Array(3*r.length),h=0;h<r.length;h++){var p=r[h],d=p[s],v=p[u],y=p[l],m=d+o,b=v+a;f[3*h]=d,f[3*h+1]=v,f[3*h+2]=y,c[h]={x:d,y:v,radius:y,minX:m-y,maxX:m+y,minY:b-y,maxY:b+y,tile:e,data:p}}this.addPoints(n,c),t.set(n.hash,f,c.length)}},{key:"removeTile",value:function(t,e){var n=e.coord;t.delete(n.hash),this.removePoints(n)}},{key:"draw",value:function(){var t=this.layer.plot,e=this.getOrthoMatrix(),n=this.shader;return t.renderBuffer.bind(),n.use(),n.setUniform("uProjectionMatrix",e),n.setUniform("uPixelRatio",t.pixelRatio),v(this.gl,this.atlas,n,e,this.getRenderables(),this.color),this.selected&&y(this.gl,this.point,n,e,t,this.selected,this.color,h),this.highlighted&&this.highlighted!==this.selected&&y(this.gl,this.point,n,e,t,this.highlighted,this.color,f),t.renderBuffer.unbind(),t.renderBuffer.blitToScreen(this.layer.opacity),this}}]),e}(c);e.exports=m},{"./WebGLInteractiveRenderer":86,"./vertex/VertexBuffer":98,"lodash/defaultTo":24}],83:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},u=t("lodash/defaultTo"),l=t("./WebGLVertexRenderer"),c={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute float aRadius;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform float uPixelRatio;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * uScale) + uTileOffset;\n\t\t\tgl_PointSize = aRadius * 2.0 * uPixelRatio;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t#extension GL_OES_standard_derivatives : enable\n\t\t#endif\n\t\tprecision highp float;\n\t\tuniform vec4 uColor;\n\t\tvoid main() {\n\t\t\tvec2 cxy = 2.0 * gl_PointCoord - 1.0;\n\t\t\tfloat radius = dot(cxy, cxy);\n\t\t\tfloat alpha = 1.0;\n\t\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t\tfloat delta = fwidth(radius);\n\t\t\t\talpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, radius);\n\t\t\t#else\n\t\t\t\tif (radius > 1.0) {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\tgl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\n\t\t}\n\t\t"},f=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.shader=null,n.atlas=null,n.color=u(t.color,[1,.4,.1,.8]),n}return o(e,t),a(e,[{key:"onAdd",value:function(t){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.ext=this.gl.getExtension("OES_standard_derivatives"),this.shader=this.createShader(c),this.atlas=this.createVertexAtlas({0:{size:2,type:"FLOAT"},1:{size:1,type:"FLOAT"}}),this}},{key:"onRemove",value:function(t){return this.destroyVertexAtlas(this.atlas),this.atlas=null,this.shader=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"draw",value:function(){var t=this.gl,e=this.shader,n=this.atlas,r=this.layer.plot,i=this.getRenderables(),o=this.getOrthoMatrix();return r.renderBuffer.bind(),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),e.use(),e.setUniform("uProjectionMatrix",o),e.setUniform("uColor",this.color),e.setUniform("uPixelRatio",r.pixelRatio),n.bind(),i.forEach(function(t){e.setUniform("uScale",t.scale),e.setUniform("uTileOffset",t.tileOffset),n.draw(t.hash,"POINTS")}),n.unbind(),r.renderBuffer.unbind(),r.renderBuffer.blitToScreen(this.layer.opacity),this}}]),e}(l);e.exports=f},{"./WebGLVertexRenderer":89,"lodash/defaultTo":24}],84:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},u=t("lodash/defaultTo"),l=t("./vertex/VertexBuffer"),c=t("./WebGLVertexRenderer"),f=.4,h=1,p=5,d={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute vec2 aOffset;\n\t\tattribute float aRadius;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * aRadius) + (aOffset * uScale) + uTileOffset;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform vec4 uColor;\n\t\tvoid main() {\n\t\t\tgl_FragColor = uColor;\n\t\t}\n\t\t"},v=function(t){var e=2*Math.PI/p,n=e/2,r=e/4,i=new Float32Array(2*p*2+4);i[0]=0,i[1]=0;for(var o=0;o<p;o++){var a=o*e,s=Math.cos(a-r)*f,u=Math.sin(a-r)*f;i[4*o+2]=s,i[4*o+1+2]=u,s=Math.cos(a+n-r)*h,u=Math.sin(a+n-r)*h,i[4*o+2+2]=s,i[4*o+3+2]=u}return i[i.length-2]=i[2],i[i.length-1]=i[3],new l(t,i,{0:{size:2,type:"FLOAT"}},{mode:"TRIANGLE_FAN",count:i.length/2})},y=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.shape=null,n.shader=null,n.atlas=null,n.color=u(t.color,[1,.4,.1,.8]),n}return o(e,t),a(e,[{key:"onAdd",value:function(t){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.shape=v(this.gl),this.shader=this.createShader(d),this.atlas=this.createVertexAtlas({1:{size:2,type:"FLOAT"},2:{size:1,type:"FLOAT"}}),this}},{key:"onRemove",value:function(t){return this.destroyVertexAtlas(this.atlas),this.atlas=null,this.shape=null,this.shader=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"draw",value:function(){var t=this.gl,e=this.shader,n=this.atlas,r=this.shape,i=this.layer.plot,o=this.getRenderables(),a=this.getOrthoMatrix();return i.renderBuffer.bind(),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),e.use(),e.setUniform("uProjectionMatrix",a),e.setUniform("uColor",this.color),r.bind(),n.bindInstanced(),o.forEach(function(t){e.setUniform("uScale",t.scale),e.setUniform("uTileOffset",t.tileOffset),n.drawInstanced(t.hash,r.mode,r.count)}),n.unbindInstanced(),r.unbind(),i.renderBuffer.unbind(),i.renderBuffer.blitToScreen(this.layer.opacity),this}}]),e}(c);e.exports=y},{"./WebGLVertexRenderer":89,"./vertex/VertexBuffer":98,"lodash/defaultTo":24}],85:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},u=t("./vertex/VertexBuffer"),l=t("./WebGLTextureRenderer"),c={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute vec2 aTextureCoord;\n\t\tuniform vec4 uTextureCoordOffset;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main() {\n\t\t\tvTextureCoord = vec2(\n\t\t\t\tuTextureCoordOffset.x + (aTextureCoord.x * uTextureCoordOffset.z),\n\t\t\t\tuTextureCoordOffset.y + (aTextureCoord.y * uTextureCoordOffset.w));\n\t\t\tvec2 wPosition = (aPosition * uScale) + uTileOffset;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform sampler2D uTextureSampler;\n\t\tuniform float uOpacity;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(uTextureSampler, vec2(vTextureCoord.x, 1.0 - vTextureCoord.y));\n\t\t\tgl_FragColor = vec4(color.rgb, color.a * uOpacity);\n\t\t}\n\t\t"},f=function(t,e,n){var r=new Float32Array(24);return r[0]=e,r[1]=e,r[2]=n,r[3]=e,r[4]=n,r[5]=n,r[6]=e,r[7]=e,r[8]=n,r[9]=n,r[10]=e,r[11]=n,r[12]=0,r[13]=0,r[14]=1,r[15]=0,r[16]=1,r[17]=1,r[18]=0,r[19]=0,r[20]=1,r[21]=1,r[22]=0,r[23]=1,new u(t,r,{0:{size:2,type:"FLOAT",byteOffset:0},1:{size:2,type:"FLOAT",byteOffset:48}},{count:6})},h=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.quad=null,n.shader=null,n.array=null,n}return o(e,t),a(e,[{key:"onAdd",value:function(t){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.quad=f(this.gl,0,t.plot.tileSize),this.shader=this.createShader(c),this.array=this.createTextureArray(t.plot.tileSize),this}},{key:"onRemove",value:function(t){return this.destroyTextureArray(this.array),this.array=null,this.quad=null,this.shader=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"draw",value:function(){var t=this.gl,e=this.shader,n=this.array,r=this.quad,i=this.getRenderablesLOD(),o=this.getOrthoMatrix();e.use(),e.setUniform("uProjectionMatrix",o),e.setUniform("uTextureSampler",0),e.setUniform("uOpacity",this.layer.opacity),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),r.bind();var a=void 0;return i.forEach(function(t){var i=t.hash;a!==i&&(n.bind(i,0),a=i),e.setUniform("uTextureCoordOffset",t.uvOffset),e.setUniform("uScale",t.scale),e.setUniform("uTileOffset",t.tileOffset),r.draw()}),r.unbind(),this}}]),e}(l);e.exports=h},{"./WebGLTextureRenderer":88,"./vertex/VertexBuffer":98}],86:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},u=t("lodash/defaultTo"),l=t("../../event/EventType"),c=t("../../event/ClickEvent"),f=t("../../event/MouseEvent"),h=t("./rtree/RTree"),p=t("./rtree/CollisionType"),d=t("./WebGLVertexRenderer"),v=Symbol(),y=Symbol(),m=Symbol(),b=function(t,e){var n=t.layer.plot,r=Math.round(n.zoom),i=Math.pow(2,r-n.zoom),o=e.x*i,a=e.y*i,s=t.trees.get(r);return s?s.search(o,a):null},g=function(t,e){var n=b(t,e.plotPx);n?(t.selected=n,t.emit(l.CLICK,new c(t.layer,e.viewPx,e.plotPx,e.button,n))):t.selected=null},w=function(t,e){var n=b(t,e.plotPx);return n?(t.highlighted?t.highlighted!==n&&(t.emit(l.MOUSE_OUT,new f(t.layer,e.viewPx,e.plotPx,e.button,t.highlighted)),t.emit(l.MOUSE_OVER,new f(t.layer,e.viewPx,e.plotPx,e.button,n))):t.emit(l.MOUSE_OVER,new f(t.layer,e.viewPx,e.plotPx,e.button,n)),void(t.highlighted=n)):(t.highlighted&&t.emit(l.MOUSE_OUT,new f(t.layer,e.viewPx,e.plotPx,e.button,t.highlighted)),void(t.highlighted=null))},x=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.trees=null,n.points=null,n.highlighted=null,n.selected=null,n.collisionType=u(t.collisionType,p.CIRCLE),n.nodeCapacity=u(t.nodeCapacity,32),n}return o(e,t),a(e,[{key:"onAdd",value:function(t){var n=this;return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.trees=new Map,this.points=new Map,this.handlers.set(v,function(t){g(n,t)}),this.handlers.set(y,function(t){w(n,t)}),this.handlers.set(m,function(){n.selected=null,n.highlighted=null}),t.plot.on(l.CLICK,this.handlers.get(v)),t.plot.on(l.MOUSE_MOVE,this.handlers.get(y)),t.plot.on(l.ZOOM_START,this.handlers.get(m)),this}},{key:"onRemove",value:function(t){return this.layer.plot.removeListener(l.CLICK,this.handlers.get(v)),this.layer.plot.removeListener(l.MOUSE_MOVE,this.handlers.get(y)),this.layer.plot.removeListener(l.ZOOM_START,this.handlers.get(m)),this.handlers.delete(v),this.handlers.delete(y),this.trees=null,this.points=null,this.highlighted=null,this.selected=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"addPoints",value:function(t,e){return this.trees.has(t.z)||this.trees.set(t.z,new h({collisionType:this.collisionType,nodeCapcity:this.nodeCapacity})),this.trees.get(t.z).insert(e),this.points.set(t.hash,e),this}},{key:"removePoints",value:function(t){var e=this.points.get(t.hash);return this.trees.get(t.z).remove(e),this.points.delete(t.hash),this}}]),e}(d);e.exports=x},{"../../event/ClickEvent":56,"../../event/EventType":58,"../../event/MouseEvent":61,"./WebGLVertexRenderer":89,"./rtree/CollisionType":90,"./rtree/RTree":91,"lodash/defaultTo":24}],87:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},u=t("./shader/Shader"),l=t("../Renderer"),c=function(t,e){return t<e?-1:t>e?1:0},f=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.gl=null,n}return o(e,t),a(e,[{key:"onAdd",value:function(t){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.gl=this.layer.plot.gl,this}},{key:"onRemove",value:function(t){return this.gl=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"createShader",value:function(t){return new u(this.gl,t)}},{key:"getOrthoMatrix",value:function(){var t=this.layer.plot.viewport,e=0,n=t.width,r=0,i=t.height,o=-1,a=1,s=1/(e-n),u=1/(r-i),l=1/(o-a),c=new Float32Array(16);return c[0]=-2*s,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*u,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*l,c[11]=0,c[12]=(e+n)*s,c[13]=(i+r)*u,c[14]=(a+o)*l,c[15]=1,c}},{key:"getRenderables",value:function(){var t=this.layer.plot,e=this.layer.pyramid,n=t.viewport.getVisibleCoords(t.tileSize,t.zoom,Math.round(t.zoom),t.wraparound),r=[];return n.forEach(function(n){var i=n.normalize(),o=e.get(i);if(o){var a=Math.pow(2,t.zoom-n.z),s=[n.x*a*t.tileSize-t.viewport.x,n.y*a*t.tileSize-t.viewport.y],u={tile:o,coord:n,scale:a,hash:i.hash,tileOffset:s};r.push(u)}}),r.sort(c),r}},{key:"getRenderablesLOD",value:function(){var t=this.layer.plot,e=this.layer.pyramid,n=t.viewport.getVisibleCoords(t.tileSize,t.zoom,Math.round(t.zoom),t.wraparound),r=[];return n.forEach(function(n){var i=e.getAvailableLOD(n);if(i){var o=Math.pow(2,t.zoom-n.z),a=[n.x*o*t.tileSize-t.viewport.x,n.y*o*t.tileSize-t.viewport.y],s={tile:i.tile,coord:n,scale:o,hash:i.tile.coord.hash,tileOffset:a,uvOffset:[i.offset.x,i.offset.y,i.offset.extent,i.offset.extent]};r.push(s)}}),r.sort(c),r}}]),e}(l);e.exports=f},{"../Renderer":78,"./shader/Shader":92}],88:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("lodash/defaultTo"),u=t("../../event/EventType"),l=t("./WebGLRenderer"),c=t("./texture/TextureArray"),f=Symbol(),h=Symbol(),p=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.format=s(t.format,"RGBA"),n.type=s(t.type,"UNSIGNED_BYTE"),n.filter=s(t.filter,"LINEAR"),n.invertY=s(t.invertY,!1),n.premultiplyAlpha=s(t.premultiplyAlpha,!1),n}return o(e,t),a(e,[{key:"addTile",value:function(t,e){t.set(e.coord.hash,e.data)}},{key:"removeTile",value:function(t,e){t.delete(e.coord.hash)}},{key:"createTextureArray",value:function(t){var e=this,n=new c(this.gl,t,{numChunks:this.layer.pyramid.totalCapacity,format:this.format,filter:this.filter,invertY:this.invertY,premultiplyAlpha:this.premultiplyAlpha}),r=function(t){e.addTile(n,t.tile)},i=function(t){e.removeTile(n,t.tile)};this.layer.on(u.TILE_ADD,r),this.layer.on(u.TILE_REMOVE,i);var o=new Map([[f,r],[h,i]]);return this.handlers.set(n,o),n}},{key:"destroyTextureArray",value:function(t){var e=this.handlers.get(t);this.layer.removeListener(u.TILE_ADD,e.get(f)),this.layer.removeListener(u.TILE_REMOVE,e.get(h)),this.handlers.delete(t)}}]),e}(l);e.exports=p},{"../../event/EventType":58,"./WebGLRenderer":87,"./texture/TextureArray":96,"lodash/defaultTo":24}],89:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("lodash/defaultTo"),u=t("../../event/EventType"),l=t("./WebGLRenderer"),c=t("./vertex/VertexAtlas"),f=Symbol(),h=Symbol(),p=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.maxVertices=s(t.maxVertices,16384),n}return o(e,t),a(e,[{key:"addTile",value:function(t,e){t.set(e.coord.hash,e.data,e.data.length/t.stride)}},{key:"removeTile",value:function(t,e){t.delete(e.coord.hash)}},{key:"createVertexAtlas",value:function(t){var e=this,n=new c(this.gl,t,{numChunks:this.layer.pyramid.totalCapacity,chunkSize:this.maxVertices}),r=function(t){e.addTile(n,t.tile)},i=function(t){e.removeTile(n,t.tile)};this.layer.on(u.TILE_ADD,r),this.layer.on(u.TILE_REMOVE,i);var o=new Map([[f,r],[h,i]]);return this.handlers.set(n,o),n}},{key:"destroyVertexAtlas",value:function(t){var e=this.handlers.get(t);this.layer.removeListener(u.TILE_ADD,e.get(f)),this.layer.removeListener(u.TILE_REMOVE,e.get(h)),this.handlers.delete(t)}}]),e}(l);e.exports=p},{"../../event/EventType":58,"./WebGLRenderer":87,"./vertex/VertexAtlas":97,"lodash/defaultTo":24}],90:[function(t,e,n){"use strict";e.exports={CIRCLE:"circle",RECTANGLE:"rectangle"}},{}],91:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("rbush"),a=t("lodash/defaultTo"),s=t("./CollisionType"),u=function(){function t(e){r(this,t),this.collisionType=a(e.collisionType,s.CIRCLE),this.tree=o(a(e.nodeCapcity,32))}return i(t,[{key:"insert",value:function(t){this.tree.load(t)}},{key:"remove",value:function(t){for(var e=this.tree,n=0;n<t.length;n++)e.remove(t[n])}},{key:"search",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.tree.search({minX:t-n,maxX:t+n,minY:e-n,maxY:e+n});if(0===r.length)return null;if(this.collisionType===s.RECTANGLE)return r[0];for(var i=0;i<r.length;i++){var o=r[i],a=.5*(o.minX+o.maxX)-t,u=.5*(o.minY+o.maxY)-e;if(a*a+u*u<=o.radius*o.radius)return o}return null}}]),t}();e.exports=u},{"./CollisionType":90,"lodash/defaultTo":24,rbush:47}],92:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("./parseShader"),a={bool:"uniform1i","bool[]":"uniform1iv",float:"uniform1f","float[]":"uniform1fv",int:"uniform1i","int[]":"uniform1iv",uint:"uniform1i","uint[]":"uniform1iv",vec2:"uniform2fv","vec2[]":"uniform2fv",ivec2:"uniform2iv","ivec2[]":"uniform2iv",vec3:"uniform3fv","vec3[]":"uniform3fv",ivec3:"uniform3iv","ivec3[]":"uniform3iv",vec4:"uniform4fv","vec4[]":"uniform4fv",ivec4:"uniform4iv","ivec4[]":"uniform4iv",mat2:"uniformMatrix2fv","mat2[]":"uniformMatrix2fv",mat3:"uniformMatrix3fv","mat3[]":"uniformMatrix3fv",mat4:"uniformMatrix4fv","mat4[]":"uniformMatrix4fv",sampler2D:"uniform1i",samplerCube:"uniform1i"},s=function(t,e,n){var r=o([e,n],["uniform","attribute"]);r.forEach(function(e){if("attribute"===e.qualifier)t.attributes.set(e.name,{type:e.type,index:t.attributes.size});else{var n=e.type+(e.count>1?"[]":"");t.uniforms.set(e.name,{type:e.type,func:a[n]})}})},u=function(t,e,n){var r=t.createShader(t[n]);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw"An error occurred compiling the shader:\n"+t.getShaderInfoLog(r);return r},l=function(t){var e=t.gl;t.attributes.forEach(function(n,r){e.bindAttribLocation(t.program,n.index,r)})},c=function(t){var e=t.gl,n=t.uniforms;n.forEach(function(r,i){var o=e.getUniformLocation(t.program,i);null===o?n.delete(i):r.location=o})},f=function(t,e){var n=t.gl,r=e.common||"",i=e.vert,o=e.frag,a=u(n,r+i,"VERTEX_SHADER"),f=u(n,r+o,"FRAGMENT_SHADER");if(s(t,i,o),t.program=n.createProgram(),n.attachShader(t.program,a),n.attachShader(t.program,f),l(t),n.linkProgram(t.program),!n.getProgramParameter(t.program,n.LINK_STATUS))throw"An error occured linking the shader:\n"+n.getProgramInfoLog(t.program);c(t)},h=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,t),!n.vert)throw"Vertex shader argument `vert` has not been provided";if(!n.frag)throw"Fragment shader argument `frag` has not been provided";this.gl=e,this.program=null,this.attributes=new Map,this.uniforms=new Map,f(this,n)}return i(t,[{key:"use",value:function(){return this.gl.useProgram(this.program),this}},{key:"setUniform",value:function(t,e){var n=this.uniforms.get(t);if(!n)throw"No uniform found under name `"+t+"`";if(void 0===e||null===e)throw"Value passed for uniform `"+t+"` is undefined or null";return"mat2"===n.type||"mat3"===n.type||"mat4"===n.type?this.gl[n.func](n.location,!1,e):this.gl[n.func](n.location,e),this}}]),t}();e.exports=h},{"./parseShader":93}],93:[function(t,e,n){"use strict";var r=/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,i=/(\r\n|\n|\r)/gm,o=/\s{2,}/g,a=/(\s*)(\[)(\s*)(\d+)(\s*)(\])(\s*)/g,s=/([a-zA-Z_][a-zA-Z0-9_]*)(?:\[(\d+)\])?/,u=/\bprecision\s+\w+\s+\w+;/g,l=/\b(highp|mediump|lowp)\s+/g,c=/#([\W\w\s\d])(?:.*\\r?\n)*.*$/gm,f=function(t){return t.replace(r,"")},h=function(t){return t.replace(u,"").replace(l,"")},p=function(t){return t.replace(i," ").replace(o," ").replace(a,"$2$4$6")},d=function(t,e,n){var r=n.match(s),i=r[1],o=void 0===r[2]?1:parseInt(r[2],10);return{qualifier:t,type:e,name:i,count:o}},v=function(t){var e=t.split(",").map(function(t){return t.trim()}),n=e.shift().split(" "),r=n.shift(),i=n.shift(),o=n.concat(e);return o.map(function(t){return d(r,i,t)})},y=function(t,e){var n=t.split(";"),r=e.join("|"),i=new RegExp("\\b("+r+")\\b.*"),o=[];return n.forEach(function(t){var e=t.match(i);e&&(o=o.concat(v(e[0])))}),o},m=function(t){var e={};return t.filter(function(t){return!e[t.name]&&(e[t.name]=!0,!0)})},b=function(t){return t.replace(c,"")};e.exports=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===t.length||0===e.length)return[];t=Array.isArray(t)?t:[t],e=Array.isArray(e)?e:[e];var n=[];return t.forEach(function(t){t=b(t),t=h(t),t=f(t),t=p(t),n=n.concat(y(t,e))}),m(n)}},{}],94:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("./Texture"),a=t("../shader/Shader"),s=t("../vertex/VertexBuffer"),u={vert:"\n\t\tprecision highp float;\n\t\tattribute vec3 aVertexPosition;\n\t\tattribute vec2 aTextureCoord;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main(void) {\n\t\t\tvTextureCoord = aTextureCoord;\n\t\t\tgl_Position = vec4(aVertexPosition, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform float uOpacity;\n\t\tuniform sampler2D uTextureSampler;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main(void) {\n\t\t\tvec4 color = texture2D(uTextureSampler, vTextureCoord);\n\t\t\tgl_FragColor = vec4(color.rgb, color.a * uOpacity);\n\t\t}\n\t\t"},l=function(t,e,n){var r=new Float32Array(24);return r[0]=e,r[1]=e,r[2]=n,r[3]=e,r[4]=n,r[5]=n,r[6]=e,r[7]=e,r[8]=n,r[9]=n,r[10]=e,r[11]=n,r[12]=0,r[13]=0,r[14]=1,r[15]=0,r[16]=1,r[17]=1,r[18]=0,r[19]=0,r[20]=1,r[21]=1,r[22]=0,r[23]=1,new s(t,r,{0:{size:2,type:"FLOAT",byteOffset:0},1:{size:2,type:"FLOAT",byteOffset:48}},{count:6})},c=function(t,e,n,r){t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t["COLOR_ATTACHMENT"+r],t.TEXTURE_2D,n.texture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)},f=function(t,e,n,r,i){n.use(),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),n.setUniform("uOpacity",i),n.setUniform("uTextureSampler",0),e.bind(0),r.bind(),r.draw(),r.unbind(),e.unbind()},h=function(){function t(e,n,i){r(this,t),this.gl=e,this.framebuffer=e.createFramebuffer(),this.shader=new a(e,u),this.quad=l(e,-1,1),this.texture=new o(e,null,{width:n,height:i,filter:"NEAREST",invertY:!1}),c(this.gl,this.framebuffer,this.texture,0)}return i(t,[{key:"bind",value:function(){var t=this.gl;return t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),this}},{key:"unbind",value:function(){
var t=this.gl;return t.bindFramebuffer(t.FRAMEBUFFER,null),this}},{key:"blitToScreen",value:function(t){return f(this.gl,this.texture,this.shader,this.quad,t),this}},{key:"resize",value:function(t,e){return this.texture.resize(t,e),this}}]),t}();e.exports=h},{"../shader/Shader":92,"../vertex/VertexBuffer":98,"./Texture":95}],95:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash/defaultTo"),a=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,t),this.gl=e,this.texture=e.createTexture(),this.format=o(i.format,"RGBA"),this.type=o(i.type,"UNSIGNED_BYTE"),this.filter=o(i.filter,"LINEAR"),this.wrap=o(i.wrap,"CLAMP_TO_EDGE"),this.invertY=o(i.invertY,!1),this.premultiplyAlpha=o(i.premultiplyAlpha,!1),this.bufferData(n,i.width,i.height),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[this.wrap]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[this.wrap]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[this.filter]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[this.filter])}return i(t,[{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.gl;return e.activeTexture(e["TEXTURE"+t]),e.bindTexture(e.TEXTURE_2D,this.texture),this}},{key:"unbind",value:function(){var t=this.gl;return t.bindTexture(t.TEXTURE_2D,null),this}},{key:"bufferData",value:function(t,e,n){var r=this.gl;return r.bindTexture(r.TEXTURE_2D,this.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.invertY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t&&t.width&&t.height?(this.width=t.width,this.height=t.height,r.texImage2D(r.TEXTURE_2D,0,r[this.format],r[this.format],r[this.type],t)):(this.width=e||this.width,this.height=n||this.height,r.texImage2D(r.TEXTURE_2D,0,r[this.format],this.width,this.height,0,r[this.format],r[this.type],t)),this}},{key:"bufferSubData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=this.gl;return o.bindTexture(o.TEXTURE_2D,this.texture),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,this.invertY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.width&&t.height?o.texSubImage2D(o.TEXTURE_2D,0,e,n,o[this.format],o[this.type],t):o.texSubImage2D(o.TEXTURE_2D,0,e,n,r,i,o[this.format],o[this.type],t),this}},{key:"resize",value:function(t,e){return this.bufferData(null,t,e),this}}]),t}();e.exports=a},{"lodash/defaultTo":24}],96:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash/defaultTo"),a=function(t,e,n,r,i,o,a){var s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),t.texImage2D(t.TEXTURE_2D,0,t[e],n,n,0,t[e],t[r],null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[i]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[i]),s},s=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,t),this.gl=e,this.numChunks=o(i.numChunks,256),this.chunkSize=n,this.format=o(i.format,"RGBA"),this.type=o(i.type,"UNSIGNED_BYTE"),this.filter=o(i.filter,"LINEAR"),this.invertY=o(i.invertY,!1),this.premultiplyAlpha=o(i.premultiplyAlpha,!1),this.available=new Array(this.numChunks);for(var s=0;s<this.numChunks;s++)this.available[s]={texture:a(this.gl,this.format,this.chunkSize,this.type,this.filter,this.invertY,this.premultiplyAlpha)};this.used=new Map}return i(t,[{key:"has",value:function(t){return this.used.has(t)}},{key:"get",value:function(t){return this.used.get(t)}},{key:"set",value:function(t,e){if(this.has(t))throw"Tile of coord "+t+" already exists in the array";if(0===this.available.length)throw"No available texture chunks in array";var n=this.available.pop(),r=this.gl;r.bindTexture(r.TEXTURE_2D,n.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.invertY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.width&&e.height?r.texImage2D(r.TEXTURE_2D,0,r[this.format],r[this.format],r[this.type],e):r.texImage2D(r.TEXTURE_2D,0,r[this.format],this.chunkSize,this.chunkSize,0,r[this.format],r[this.type],e),this.used.set(t,n)}},{key:"delete",value:function(t){if(!this.has(t))throw"Tile of coord "+t+" does not exist in the array";var e=this.used.get(t);return this.used.delete(t),this.available.push(e),this}},{key:"bind",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.has(t))throw"Tile of coord "+t+" does not exist in the array";var n=this.gl,r=this.used.get(t);return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,r.texture),this}},{key:"unbind",value:function(){return this}}]),t}();e.exports=s},{"lodash/defaultTo":24}],97:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash/defaultTo"),a=t("lodash/forIn"),s={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FIXED:4,FLOAT:4},u=function(t,e){var n=0;return t.forEach(function(t){n+=s[t.type]*t.size*e}),n},l=function(t,e,n){var r=0;e.forEach(function(e,i){t.byteOffsets[i]=n+r,r+=s[e.type]*e.size})},c=function(t){var e=0;return t.forEach(function(t){e+=t.size}),e},f=function(t){var e=new Map,n=0;return a(t,function(t,r){e.set(r,{type:t.type,size:t.size,byteOffset:n,byteStride:0}),n+=s[t.type]*t.size}),e.forEach(function(t){t.byteStride=n}),e},h=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,t),this.gl=e,this.ext=e.getExtension("ANGLE_instanced_arrays"),!this.ext)throw"ANGLE_instanced_arrays WebGL extension is not supported";this.numChunks=o(i.numChunks,256),this.chunkSize=o(i.chunkSize,16384),this.pointers=f(n),this.stride=c(this.pointers),this.available=new Array(this.numChunks);for(var a=u(this.pointers,this.chunkSize),s=0;s<this.numChunks;s++){var h=s*this.chunkSize,p=s*a,d={count:0,chunkOffset:h,chunkByteOffset:p,byteOffsets:{}};l(d,this.pointers,p),this.available[s]=d}this.used=new Map,this.buffer=e.createBuffer();var v=a*this.numChunks;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,v,e.DYNAMIC_DRAW)}return i(t,[{key:"has",value:function(t){return this.used.has(t)}},{key:"get",value:function(t){return this.used.get(t)}},{key:"set",value:function(t,e,n){if(this.has(t))throw"Tile of coord "+t+" already exists in the atlas";if(0===this.available.length)throw"No available vertex chunks in atlas";var r=this.available.pop();if(r.count=n,n>0){var i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferSubData(i.ARRAY_BUFFER,r.chunkByteOffset,e)}this.used.set(t,r)}},{key:"delete",value:function(t){if(!this.has(t))throw"Tile of coord "+t+" does not exist in the atlas";var e=this.used.get(t);return this.used.delete(t),this.available.push(e),this}},{key:"bind",value:function(){var t=this.gl;return t.bindBuffer(t.ARRAY_BUFFER,this.buffer),this.pointers.forEach(function(e,n){t.enableVertexAttribArray(n),t.vertexAttribPointer(n,e.size,t[e.type],!1,e.byteStride,e.byteOffset)}),this}},{key:"bindInstanced",value:function(){var t=this.gl,e=this.ext;return t.bindBuffer(t.ARRAY_BUFFER,this.buffer),this.pointers.forEach(function(n,r){t.enableVertexAttribArray(r),e.vertexAttribDivisorANGLE(r,1)}),this}},{key:"unbind",value:function(){var t=this.gl;return this.pointers.forEach(function(e,n){t.disableVertexAttribArray(n)}),this}},{key:"unbindInstanced",value:function(){var t=this.gl,e=this.ext;return this.pointers.forEach(function(n,r){t.disableVertexAttribArray(r),e.vertexAttribDivisorANGLE(r,0)}),this}},{key:"draw",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.has(t))throw"Tile of coord "+t+" does not exist in the atlas";var i=this.gl,o=this.used.get(t);o.count>0&&i.drawArrays(i[e],o.chunkOffset+n,r?r:o.count)}},{key:"drawInstanced",value:function(t,e,n){if(!this.has(t))throw"Tile of coord "+t+" does not exist in the atlas";var r=this.gl,i=this.ext,o=this.used.get(t);this.pointers.forEach(function(t,e){r.vertexAttribPointer(e,t.size,r[t.type],!1,t.byteStride,o.byteOffsets[e])}),o.count>0&&i.drawArraysInstancedANGLE(r[e],0,n,o.count)}}]),t}();e.exports=h},{"lodash/defaultTo":24,"lodash/forIn":25}],98:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("lodash/defaultTo"),a=t("lodash/forIn"),s={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FIXED:4,FLOAT:4},u=function(t){if(1===t.size)return 0;var e=0,n=0,r=0;return t.forEach(function(t){var i=t.byteOffset,o=t.size,a=t.type;n+=o*s[a],i>e&&(e=i,r=i+o*s[a])}),e>=n?0:r},l=function(t){var e=new Map;return a(t,function(t,n){var r=parseInt(n,10);t.byteOffset=o(t.byteOffset,0),e.set(r,t)}),e},c=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r(this,t),this.gl=e,this.mode=o(a.mode,"TRIANGLES"),this.count=o(a.count,0),this.indexOffset=o(a.indexOffset,0),this.pointers=l(i),this.byteStride=u(this.pointers),n instanceof WebGLBuffer?this.buffer=n:(this.buffer=e.createBuffer(),n&&this.bufferData(n))}return i(t,[{key:"bufferData",value:function(t){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}},{key:"bufferSubData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.gl;return n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.bufferSubData(n.ARRAY_BUFFER,e,t),this}},{key:"bind",value:function(){var t=this,e=this.gl;return e.bindBuffer(e.ARRAY_BUFFER,this.buffer),this.pointers.forEach(function(n,r){e.vertexAttribPointer(r,n.size,e[n.type],!1,t.byteStride,n.byteOffset),e.enableVertexAttribArray(r)}),this}},{key:"unbind",value:function(){var t=this.gl;return this.pointers.forEach(function(e,n){t.disableVertexAttribArray(n)}),this}},{key:"draw",value:function(){var t=this.gl;return t.drawArrays(t[this.mode],this.indexOffset,this.count),this}}]),t}();e.exports=c},{"lodash/defaultTo":24,"lodash/forIn":25}],99:[function(t,e,n){"use strict";e.exports=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){var t=n.response;if(t)e(null,t);else{var r="Unable to load ArrayBuffer from URL: `"+event.path[0].currentSrc+"`";e(r,null)}},n.onerror=function(t){var n="Unable to load ArrayBuffer from URL: `"+t.path[0].currentSrc+"`";e(n,null)},n.withCredentials=!0,n.send(null)}},{}],100:[function(t,e,n){"use strict";e.exports=function(t,e){var n=new Image;n.onload=function(){e(null,n)},n.onerror=function(t){var n="Unable to load image from URL: `"+t.path[0].currentSrc+"`";e(n,null)},n.crossOrigin="anonymous",n.src=t}},{}]},{},[66])(66)});